<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IFPACK: Ex_AmesosPrec</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IFPACK<span id="projectnumber">&#160;Development</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Ex_AmesosPrec</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="fragment"><div class="line"><span class="comment">//@HEADER</span></div>
<div class="line"><span class="comment">// ***********************************************************************</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//       Ifpack: Object-Oriented Algebraic Preconditioner Package</span></div>
<div class="line"><span class="comment">//                 Copyright (2002) Sandia Corporation</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Under terms of Contract DE-AC04-94AL85000, there is a non-exclusive</span></div>
<div class="line"><span class="comment">// license for use of this work by or on behalf of the U.S. Government.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">// modification, are permitted provided that the following conditions are</span></div>
<div class="line"><span class="comment">// met:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 1. Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment">// notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 2. Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment">// notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment">// documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 3. Neither the name of the Corporation nor the names of the</span></div>
<div class="line"><span class="comment">// contributors may be used to endorse or promote products derived from</span></div>
<div class="line"><span class="comment">// this software without specific prior written permission.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// THIS SOFTWARE IS PROVIDED BY SANDIA CORPORATION &quot;AS IS&quot; AND ANY</span></div>
<div class="line"><span class="comment">// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div>
<div class="line"><span class="comment">// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span></div>
<div class="line"><span class="comment">// PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL SANDIA CORPORATION OR THE</span></div>
<div class="line"><span class="comment">// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span></div>
<div class="line"><span class="comment">// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span></div>
<div class="line"><span class="comment">// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></div>
<div class="line"><span class="comment">// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span></div>
<div class="line"><span class="comment">// LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></div>
<div class="line"><span class="comment">// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></div>
<div class="line"><span class="comment">// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Questions? Contact Michael A. Heroux (maherou@sandia.gov)</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// ***********************************************************************</span></div>
<div class="line"><span class="comment">//@HEADER</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;Ifpack_ConfigDefs.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_MpiComm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_SerialComm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_CrsMatrix.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_MultiVector.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_Map.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_BlockMap.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_LinearProblem.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Galeri_Maps.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Galeri_CrsMatrices.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Teuchos_ParameterList.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Teuchos_RefCountPtr.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;AztecOO.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Ifpack.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// initialize MPI and Epetra communicator</span></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line">  MPI_Init(&amp;argc,&amp;argv);</div>
<div class="line">  <a class="code hl_classRef" href="../../../epetra/doc/html/classEpetra__MpiComm.html">Epetra_MpiComm</a> Comm( MPI_COMM_WORLD );</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  <a class="code hl_classRef" href="../../../epetra/doc/html/classEpetra__SerialComm.html">Epetra_SerialComm</a> Comm;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::ParameterList GaleriList;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// The problem is defined on a 2D grid, global size is nx * nx.</span></div>
<div class="line">  <span class="keywordtype">int</span> nx = 30; </div>
<div class="line">  GaleriList.set(<span class="stringliteral">&quot;nx&quot;</span>, nx);</div>
<div class="line">  GaleriList.set(<span class="stringliteral">&quot;ny&quot;</span>, nx * Comm.<a class="code hl_functionRef" href="../../../epetra/doc/html/classEpetra__SerialComm.html#af55220ff6540694c810aa9f2b3ec146f">NumProc</a>());</div>
<div class="line">  GaleriList.set(<span class="stringliteral">&quot;mx&quot;</span>, 1);</div>
<div class="line">  GaleriList.set(<span class="stringliteral">&quot;my&quot;</span>, Comm.<a class="code hl_functionRef" href="../../../epetra/doc/html/classEpetra__SerialComm.html#af55220ff6540694c810aa9f2b3ec146f">NumProc</a>());</div>
<div class="line">  Teuchos::RefCountPtr&lt;Epetra_Map&gt; Map = Teuchos::rcp( Galeri::CreateMap(<span class="stringliteral">&quot;Cartesian2D&quot;</span>, Comm, GaleriList) );</div>
<div class="line">  Teuchos::RefCountPtr&lt;Epetra_RowMatrix&gt; A = Teuchos::rcp( Galeri::CreateCrsMatrix(<span class="stringliteral">&quot;Laplace2D&quot;</span>, &amp;*Map, GaleriList) );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// =============================================================== //</span></div>
<div class="line">  <span class="comment">// B E G I N N I N G   O F   I F P A C K   C O N S T R U C T I O N //</span></div>
<div class="line">  <span class="comment">// =============================================================== //</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::ParameterList List;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// allocates an IFPACK factory. No data is associated </span></div>
<div class="line">  <span class="comment">// to this object (only method Create()).</span></div>
<div class="line">  <a class="code hl_class" href="classIfpack.html">Ifpack</a> Factory;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create the preconditioner. For valid PrecType values,</span></div>
<div class="line">  <span class="comment">// please check the documentation</span></div>
<div class="line">  std::string PrecType = <span class="stringliteral">&quot;Amesos&quot;</span>;</div>
<div class="line">  <span class="keywordtype">int</span> OverlapLevel = 2; <span class="comment">// must be &gt;= 0. If Comm.NumProc() == 1,</span></div>
<div class="line">                        <span class="comment">// it is ignored.</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::RefCountPtr&lt;Ifpack_Preconditioner&gt; Prec = Teuchos::rcp( Factory.<a class="code hl_function" href="classIfpack.html#a03a44332365fc78e64397c8a919cd3f8">Create</a>(PrecType, &amp;*A, OverlapLevel) );</div>
<div class="line">  assert(Prec != Teuchos::null);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// specify the Amesos solver to be used. </span></div>
<div class="line">  <span class="comment">// If the selected solver is not available,</span></div>
<div class="line">  <span class="comment">// IFPACK will try to use Amesos&#39; KLU (which is usually always</span></div>
<div class="line">  <span class="comment">// compiled). Amesos&#39; serial solvers are:</span></div>
<div class="line">  <span class="comment">// &quot;Amesos_Klu&quot;, &quot;Amesos_Umfpack&quot;, &quot;Amesos_Superlu&quot;</span></div>
<div class="line">  List.set(<span class="stringliteral">&quot;amesos: solver type&quot;</span>, <span class="stringliteral">&quot;Amesos_Klu&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// sets the parameters</span></div>
<div class="line">  IFPACK_CHK_ERR(Prec-&gt;SetParameters(List));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// initialize the preconditioner. At this point the matrix must</span></div>
<div class="line">  <span class="comment">// have been FillComplete()&#39;d, but actual values are ignored.</span></div>
<div class="line">  <span class="comment">// At this call, Amesos will perform the symbolic factorization.</span></div>
<div class="line">  IFPACK_CHK_ERR(Prec-&gt;Initialize());</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Builds the preconditioners, by looking for the values of </span></div>
<div class="line">  <span class="comment">// the matrix. At this call, Amesos will perform the</span></div>
<div class="line">  <span class="comment">// numeric factorization.</span></div>
<div class="line">  IFPACK_CHK_ERR(Prec-&gt;Compute());</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// =================================================== //</span></div>
<div class="line">  <span class="comment">// E N D   O F   I F P A C K   C O N S T R U C T I O N //</span></div>
<div class="line">  <span class="comment">// =================================================== //</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// At this point, we need some additional objects</span></div>
<div class="line">  <span class="comment">// to define and solve the linear system.</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// defines LHS and RHS</span></div>
<div class="line">  <a class="code hl_classRef" href="../../../epetra/doc/html/classEpetra__Vector.html">Epetra_Vector</a> LHS(A-&gt;OperatorDomainMap());</div>
<div class="line">  <a class="code hl_classRef" href="../../../epetra/doc/html/classEpetra__Vector.html">Epetra_Vector</a> RHS(A-&gt;OperatorDomainMap());</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// solution is constant</span></div>
<div class="line">  LHS.PutScalar(1.0);</div>
<div class="line">  <span class="comment">// now build corresponding RHS</span></div>
<div class="line">  A-&gt;Apply(LHS,RHS);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// now randomize the solution</span></div>
<div class="line">  RHS.Random();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// need an Epetra_LinearProblem to define AztecOO solver</span></div>
<div class="line">  <a class="code hl_classRef" href="../../../epetra/doc/html/classEpetra__LinearProblem.html">Epetra_LinearProblem</a> Problem(&amp;*A,&amp;LHS,&amp;RHS);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// now we can allocate the AztecOO solver</span></div>
<div class="line">  AztecOO Solver(Problem);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// specify solver</span></div>
<div class="line">  Solver.SetAztecOption(AZ_solver,AZ_gmres);</div>
<div class="line">  Solver.SetAztecOption(AZ_output,32);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HERE WE SET THE IFPACK PRECONDITIONER</span></div>
<div class="line">  Solver.SetPrecOperator(&amp;*Prec);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// .. and here we solve</span></div>
<div class="line">  <span class="comment">// NOTE: with one process, the solver must converge in</span></div>
<div class="line">  <span class="comment">// one iteration.</span></div>
<div class="line">  Solver.Iterate(1550,1e-8);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line">  MPI_Finalize() ; </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>(EXIT_SUCCESS);</div>
<div class="line">}</div>
<div class="ttc" id="aclassEpetra__LinearProblem_html"><div class="ttname"><a href="../../../epetra/doc/html/classEpetra__LinearProblem.html">Epetra_LinearProblem</a></div></div>
<div class="ttc" id="aclassEpetra__MpiComm_html"><div class="ttname"><a href="../../../epetra/doc/html/classEpetra__MpiComm.html">Epetra_MpiComm</a></div></div>
<div class="ttc" id="aclassEpetra__SerialComm_html"><div class="ttname"><a href="../../../epetra/doc/html/classEpetra__SerialComm.html">Epetra_SerialComm</a></div></div>
<div class="ttc" id="aclassEpetra__SerialComm_html_af55220ff6540694c810aa9f2b3ec146f"><div class="ttname"><a href="../../../epetra/doc/html/classEpetra__SerialComm.html#af55220ff6540694c810aa9f2b3ec146f">Epetra_SerialComm::NumProc</a></div><div class="ttdeci">int NumProc() const</div></div>
<div class="ttc" id="aclassEpetra__Vector_html"><div class="ttname"><a href="../../../epetra/doc/html/classEpetra__Vector.html">Epetra_Vector</a></div></div>
<div class="ttc" id="aclassIfpack_html"><div class="ttname"><a href="classIfpack.html">Ifpack</a></div><div class="ttdoc">Ifpack: a function class to define Ifpack preconditioners.</div><div class="ttdef"><b>Definition</b> <a href="Ifpack_8h_source.html#l00144">Ifpack.h:144</a></div></div>
<div class="ttc" id="aclassIfpack_html_a03a44332365fc78e64397c8a919cd3f8"><div class="ttname"><a href="classIfpack.html#a03a44332365fc78e64397c8a919cd3f8">Ifpack::Create</a></div><div class="ttdeci">static Ifpack_Preconditioner * Create(EPrecType PrecType, Epetra_RowMatrix *Matrix, const int overlap=0, bool overrideSerialDefault=false)</div><div class="ttdoc">Creates an instance of Ifpack_Preconditioner given the enum value of the preconditioner type (can not...</div><div class="ttdef"><b>Definition</b> <a href="Ifpack_8cpp_source.html#l00253">Ifpack.cpp:253</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 9 2025 20:38:00 for IFPACK by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
