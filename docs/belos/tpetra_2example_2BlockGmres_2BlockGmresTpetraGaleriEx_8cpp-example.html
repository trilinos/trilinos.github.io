<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Belos: tpetra/example/BlockGmres/BlockGmresTpetraGaleriEx.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Belos<span id="projectnumber">&#160;Version of the Day</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">tpetra/example/BlockGmres/BlockGmresTpetraGaleriEx.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>This is an example of how to use the <a class="el" href="classBelos_1_1BlockGmresSolMgr.html" title="Interface to Block GMRES and Flexible GMRES.">Belos::BlockGmresSolMgr</a> solver manager using Tpetra and Galeri.</p>
<p>This is an example of how to use the <a class="el" href="classBelos_1_1BlockGmresSolMgr.html" title="Interface to Block GMRES and Flexible GMRES.">Belos::BlockGmresSolMgr</a> solver manager using Tpetra and Galeri.</p>
<div class="fragment"><div class="line"><span class="comment">// @HEADER</span></div>
<div class="line"><span class="comment">// *****************************************************************************</span></div>
<div class="line"><span class="comment">//                 Belos: Block Linear Solvers Package</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Copyright 2004-2016 NTESS and the Belos contributors.</span></div>
<div class="line"><span class="comment">// SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment">// *****************************************************************************</span></div>
<div class="line"><span class="comment">// @HEADER</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Tpetra</span></div>
<div class="line"><span class="preprocessor">#include &lt;Tpetra_Core.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Tpetra_CrsMatrix.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Tpetra_MultiVector.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Galeri</span></div>
<div class="line"><span class="preprocessor">#include &lt;Galeri_XpetraMaps.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Galeri_XpetraMatrixTypes.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Galeri_XpetraProblemFactory.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Teuchos</span></div>
<div class="line"><span class="preprocessor">#include &lt;Teuchos_RCP.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Teuchos_Comm.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Teuchos_CommHelpers.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Teuchos_DefaultComm.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Teuchos_ParameterList.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Teuchos_TypeNameTraits.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Teuchos_oblackholestream.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Teuchos_StandardCatchMacros.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Teuchos_CommandLineProcessor.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Belos</span></div>
<div class="line"><span class="preprocessor">#include &quot;BelosTpetraAdapter.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="BelosBlockGmresSolMgr_8hpp.html">BelosBlockGmresSolMgr.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="BelosPseudoBlockGmresSolMgr_8hpp.html">BelosPseudoBlockGmresSolMgr.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ****************************************************************************</span></div>
<div class="line"><span class="comment">// BEGIN RUN ROUTINE</span></div>
<div class="line"><span class="comment">// ****************************************************************************</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ScalarType&gt;</div>
<div class="line"><span class="keywordtype">int</span> run(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Belos solvers have the following template parameters:</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">//   - Scalar: The type of dot product results.</span></div>
<div class="line">  <span class="comment">//   - MV: The type of (multi)vectors.</span></div>
<div class="line">  <span class="comment">//   - OP: The type of operators (functions from multivector to</span></div>
<div class="line">  <span class="comment">//     multivector).  A matrix (like Tpetra::CrsMatrix) is an example</span></div>
<div class="line">  <span class="comment">//     of an operator; an Ifpack2 preconditioner is another example.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Here, ST is set by the main function, MV is Tpetra::MultiVector, and OP is</span></div>
<div class="line">  <span class="comment">// Tpetra::Operator.</span></div>
<div class="line">  <span class="keyword">using </span>ST = <span class="keyword">typename</span> Tpetra::MultiVector&lt;ScalarType&gt;::scalar_type;</div>
<div class="line">  <span class="keyword">using </span>LO = <span class="keyword">typename</span> Tpetra::MultiVector&lt;&gt;::local_ordinal_type;</div>
<div class="line">  <span class="keyword">using </span>GO = <span class="keyword">typename</span> Tpetra::MultiVector&lt;&gt;::global_ordinal_type;</div>
<div class="line">  <span class="keyword">using </span>NT = <span class="keyword">typename</span> Tpetra::MultiVector&lt;&gt;::node_type;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using </span>OP  = <span class="keyword">typename</span> Tpetra::Operator&lt;ST,LO,GO,NT&gt;;</div>
<div class="line">  <span class="keyword">using </span>MV  = <span class="keyword">typename</span> Tpetra::MultiVector&lt;ST,LO,GO,NT&gt;;</div>
<div class="line">  <span class="keyword">using </span>MT = <span class="keyword">typename</span> Teuchos::ScalarTraits&lt;ST&gt;::magnitudeType;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using </span>tmap_t       = Tpetra::Map&lt;LO,GO,NT&gt;;</div>
<div class="line">  <span class="keyword">using </span>tcrsmatrix_t = Tpetra::CrsMatrix&lt;ST,LO,GO,NT&gt;;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using </span>MVT = <span class="keyword">typename</span> <a id="_a0" name="_a0"></a><a class="code hl_class" href="classBelos_1_1Operator.html">Belos::MultiVecTraits&lt;ST,MV&gt;</a>;</div>
<div class="line">  <span class="keyword">using </span>OPT = <span class="keyword">typename</span> <a class="code hl_class" href="classBelos_1_1Operator.html">Belos::OperatorTraits&lt;ST,MV,OP&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using </span>Teuchos::RCP;</div>
<div class="line">  <span class="keyword">using </span>Teuchos::rcp;</div>
<div class="line">  <span class="keyword">using </span>Teuchos::ParameterList;</div>
<div class="line"> </div>
<div class="line">  Teuchos::GlobalMPISession mpiSession (&amp;argc, &amp;argv, &amp;std::cout);</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> comm = Tpetra::getDefaultComm();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> myPID = comm-&gt;getRank();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">bool</span> verbose = <span class="keyword">false</span>;</div>
<div class="line">  <span class="keywordtype">bool</span> success = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <span class="keywordtype">bool</span> procVerbose = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> debug = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> pseudo = <span class="keyword">false</span>;       <span class="comment">// use pseudo-block or block gmres</span></div>
<div class="line">    <span class="keywordtype">int</span> frequency = -1;        <span class="comment">// frequency of status test output</span></div>
<div class="line">    <span class="keywordtype">int</span> blockSize = 1;         <span class="comment">// blockSize</span></div>
<div class="line">    <span class="keywordtype">int</span> numrhs = 1;            <span class="comment">// number of right-hand sides to solve for</span></div>
<div class="line">    <span class="keywordtype">int</span> maxIters = -1;         <span class="comment">// maximum number of iterations allowed per linear system</span></div>
<div class="line">    <span class="keywordtype">int</span> maxSubspace = 50;      <span class="comment">// maximum number of blocks the solver can use for the subspace</span></div>
<div class="line">    <span class="keywordtype">int</span> maxRestarts = 15;      <span class="comment">// number of restarts allowed</span></div>
<div class="line">    <span class="keywordtype">int</span> nx = 10;               <span class="comment">// number of discretization points in each direction</span></div>
<div class="line">    MT tol = 1.0e-5;           <span class="comment">// relative residual tolerance</span></div>
<div class="line">    std::string ortho = <span class="stringliteral">&quot;DGKS&quot;</span>;<span class="comment">// orthogonalization method</span></div>
<div class="line"> </div>
<div class="line">    Teuchos::CommandLineProcessor cmdp(<span class="keyword">false</span>,<span class="keyword">true</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;verbose&quot;</span>,<span class="stringliteral">&quot;quiet&quot;</span>,&amp;verbose,<span class="stringliteral">&quot;Print messages and results.&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;debug&quot;</span>,<span class="stringliteral">&quot;nondebug&quot;</span>,&amp;debug,<span class="stringliteral">&quot;Print debugging information from solver.&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;pseudo&quot;</span>,<span class="stringliteral">&quot;block&quot;</span>,&amp;pseudo,<span class="stringliteral">&quot;Use pseudo-block or block GMRES solver.&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;frequency&quot;</span>,&amp;frequency,<span class="stringliteral">&quot;Solvers frequency for printing residuals (#iters).&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;tol&quot;</span>,&amp;tol,<span class="stringliteral">&quot;Relative residual tolerance used by GMRES solver.&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;num-rhs&quot;</span>,&amp;numrhs,<span class="stringliteral">&quot;Number of right-hand sides to be solved for.&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;block-size&quot;</span>,&amp;blockSize,<span class="stringliteral">&quot;Block size used by GMRES.&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;max-iters&quot;</span>,&amp;maxIters,<span class="stringliteral">&quot;Maximum number of iterations per linear system (-1 = adapted to problem/block size).&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;max-subspace&quot;</span>,&amp;maxSubspace,<span class="stringliteral">&quot;Maximum number of blocks the solver can use for the subspace.&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;max-restarts&quot;</span>,&amp;maxRestarts,<span class="stringliteral">&quot;Maximum number of restarts allowed for GMRES solver.&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;nx&quot;</span>,&amp;nx,<span class="stringliteral">&quot;Number of discretization points in each direction of 3D Laplacian.&quot;</span>);</div>
<div class="line">    cmdp.setOption(<span class="stringliteral">&quot;ortho&quot;</span>,&amp;ortho,<span class="stringliteral">&quot;Orthogonalization being used by GMRES solver.&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (cmdp.parse(argc,argv) != Teuchos::CommandLineProcessor::PARSE_SUCCESSFUL) {</div>
<div class="line">      <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (!verbose)</div>
<div class="line">      frequency = -1;  <span class="comment">// reset frequency if test is not verbose</span></div>
<div class="line"> </div>
<div class="line">    procVerbose = ( verbose &amp;&amp; (myPID==0) ); <span class="comment">// Only print on the zero processor</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (procVerbose) {</div>
<div class="line">      std::cout &lt;&lt; <a id="a1" name="a1"></a><a class="code hl_function" href="namespaceBelos.html#af5ec042691e0f15dd1b2a66f0eb22679">Belos::Belos_Version</a>() &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set up the test problem.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// We use Trilinos&#39; Galeri package to construct a test problem.</span></div>
<div class="line">    <span class="comment">// Here, we use a discretization of the 2-D Laplacian operator.</span></div>
<div class="line">    <span class="comment">// The global mesh size is nx * nx.</span></div>
<div class="line"> </div>
<div class="line">    Teuchos::ParameterList GaleriList;</div>
<div class="line">    GaleriList.set (<span class="stringliteral">&quot;n&quot;</span>, nx * nx * nx);</div>
<div class="line">    GaleriList.set (<span class="stringliteral">&quot;nx&quot;</span>, nx);</div>
<div class="line">    GaleriList.set (<span class="stringliteral">&quot;ny&quot;</span>, nx);</div>
<div class="line">    GaleriList.set (<span class="stringliteral">&quot;nz&quot;</span>, nx);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> Map = RCP{Galeri::Xpetra::CreateMap&lt;LO,GO,tmap_t&gt;(<span class="stringliteral">&quot;Cartesian3D&quot;</span>, comm, GaleriList)};</div>
<div class="line">    <span class="keyword">auto</span> GaleriProblem = Galeri::Xpetra::BuildProblem&lt;ST,LO,GO,tmap_t,tcrsmatrix_t,MV&gt;(<span class="stringliteral">&quot;Laplace3D&quot;</span>, Map, GaleriList);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create matrix from problem</span></div>
<div class="line">    <span class="keyword">auto</span> A = GaleriProblem-&gt;BuildMatrix();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create RHS using random solution vector</span></div>
<div class="line">    RCP&lt;MV&gt; B = rcp (<span class="keyword">new</span> MV (Map, numrhs));</div>
<div class="line">    RCP&lt;MV&gt; X = rcp (<span class="keyword">new</span> MV (Map, numrhs));</div>
<div class="line">    RCP&lt;MV&gt; Xexact = rcp (<span class="keyword">new</span> MV (Map, numrhs));</div>
<div class="line">    MVT::MvRandom(*Xexact);</div>
<div class="line"> </div>
<div class="line">    OPT::Apply(*A, *Xexact, *B );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ********Other information used by block solver***********</span></div>
<div class="line">    <span class="comment">// *****************(can be user specified)******************</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> numGlobalElements = B-&gt;getGlobalLength();</div>
<div class="line">    <span class="keywordflow">if</span> (maxIters == -1)</div>
<div class="line">      maxIters = numGlobalElements/blockSize - 1; <span class="comment">// maximum number of iterations to run</span></div>
<div class="line"> </div>
<div class="line">    ParameterList belosList;</div>
<div class="line">    belosList.set( <span class="stringliteral">&quot;Num Blocks&quot;</span>, maxSubspace);             <span class="comment">// Maximum number of blocks in Krylov factorization</span></div>
<div class="line">    belosList.set( <span class="stringliteral">&quot;Block Size&quot;</span>, blockSize );              <span class="comment">// BlockSize to be used by iterative solver</span></div>
<div class="line">    belosList.set( <span class="stringliteral">&quot;Maximum Iterations&quot;</span>, maxIters );       <span class="comment">// Maximum number of iterations allowed</span></div>
<div class="line">    belosList.set( <span class="stringliteral">&quot;Maximum Restarts&quot;</span>, maxRestarts );      <span class="comment">// Maximum number of restarts allowed</span></div>
<div class="line">    belosList.set( <span class="stringliteral">&quot;Convergence Tolerance&quot;</span>, tol );         <span class="comment">// Relative convergence tolerance requested</span></div>
<div class="line">    belosList.set( <span class="stringliteral">&quot;Orthogonalization&quot;</span>, ortho );           <span class="comment">// Orthogonalization used by iterative solver</span></div>
<div class="line">    <span class="keywordtype">int</span> verbosity = <a id="a2" name="a2"></a><a class="code hl_enumvalue" href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a63033b406b3bb6a654a538f9b13e34ec">Belos::Errors</a> + <a id="a3" name="a3"></a><a class="code hl_enumvalue" href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a7ea40ab539dda8218818a3b391f88ff7">Belos::Warnings</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (verbose) {</div>
<div class="line">      verbosity += <a id="a4" name="a4"></a><a class="code hl_enumvalue" href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a54629124d7d6823ab26d8e1df854d962">Belos::TimingDetails</a> + <a id="a5" name="a5"></a><a class="code hl_enumvalue" href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a214b85228315388f0b0fea24202ba4e4">Belos::StatusTestDetails</a>;</div>
<div class="line">      <span class="keywordflow">if</span> (frequency &gt; 0)</div>
<div class="line">        belosList.set( <span class="stringliteral">&quot;Output Frequency&quot;</span>, frequency );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (debug) {</div>
<div class="line">      verbosity += <a id="a6" name="a6"></a><a class="code hl_enumvalue" href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a9412d40e3f67e98d566374c3bc2b6439">Belos::Debug</a>;</div>
<div class="line">    }</div>
<div class="line">    belosList.set( <span class="stringliteral">&quot;Verbosity&quot;</span>, verbosity );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Construct an unpreconditioned linear problem instance.</span></div>
<div class="line">    <a class="code hl_class" href="classBelos_1_1Operator.html">Belos::LinearProblem&lt;ST,MV,OP&gt;</a> problem( A, X, B );</div>
<div class="line">    <span class="keywordtype">bool</span> set = problem.setProblem();</div>
<div class="line">    <span class="keywordflow">if</span> (set == <span class="keyword">false</span>) {</div>
<div class="line">      <span class="keywordflow">if</span> (procVerbose)</div>
<div class="line">        std::cout &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;ERROR:  Belos::LinearProblem failed to set up correctly!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// *******************************************************************</span></div>
<div class="line">    <span class="comment">// *************Start the block Gmres iteration*************************</span></div>
<div class="line">    <span class="comment">// *******************************************************************</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create an iterative solver manager.</span></div>
<div class="line">    RCP&lt; Belos::SolverManager&lt;ST,MV,OP&gt; &gt; newSolver;</div>
<div class="line">    <span class="keywordflow">if</span> (pseudo &amp;&amp; (blockSize == 1))</div>
<div class="line">      newSolver = rcp( <span class="keyword">new</span> <a class="code hl_class" href="classBelos_1_1Operator.html">Belos::PseudoBlockGmresSolMgr&lt;ST,MV,OP&gt;</a>(rcp(&amp;problem,<span class="keyword">false</span>), rcp(&amp;belosList,<span class="keyword">false</span>)));</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      newSolver = rcp( <span class="keyword">new</span> <a class="code hl_class" href="classBelos_1_1Operator.html">Belos::BlockGmresSolMgr&lt;ST,MV,OP&gt;</a>(rcp(&amp;problem,<span class="keyword">false</span>), rcp(&amp;belosList,<span class="keyword">false</span>)));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// **********Print out information about problem*******************</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (procVerbose) {</div>
<div class="line">      std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Dimension of matrix: &quot;</span> &lt;&lt; numGlobalElements &lt;&lt; std::endl;</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Number of right-hand sides: &quot;</span> &lt;&lt; numrhs &lt;&lt; std::endl;</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Block size used by solver: &quot;</span> &lt;&lt; blockSize &lt;&lt; std::endl;</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Max number of restarts allowed: &quot;</span> &lt;&lt; maxRestarts &lt;&lt; std::endl;</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Max number of Gmres iterations per linear system: &quot;</span> &lt;&lt; maxIters &lt;&lt; std::endl;</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Relative residual tolerance: &quot;</span> &lt;&lt; tol &lt;&lt; std::endl;</div>
<div class="line">      std::cout &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Perform solve</span></div>
<div class="line">    <a class="code hl_enumeration" href="namespaceBelos.html#a58f4f203f3b36e10cb1ffd4614bbd18b">Belos::ReturnType</a> ret = newSolver-&gt;solve();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get the number of iterations for this solve.</span></div>
<div class="line">    <span class="keywordtype">int</span> numIters = newSolver-&gt;getNumIters();</div>
<div class="line">    <span class="keywordflow">if</span> (procVerbose)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Number of iterations performed for this solve: &quot;</span> &lt;&lt; numIters &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Compute actual residuals.</span></div>
<div class="line">    <span class="keywordtype">bool</span> badRes = <span class="keyword">false</span>;</div>
<div class="line">    std::vector&lt;ST&gt; actualResids( numrhs );</div>
<div class="line">    std::vector&lt;ST&gt; rhsNorm( numrhs );</div>
<div class="line">    MV resid(Map, numrhs);</div>
<div class="line">    OPT::Apply( *A, *X, resid );</div>
<div class="line">    MVT::MvAddMv( -1.0, resid, 1.0, *B, resid );</div>
<div class="line">    MVT::MvNorm( resid, actualResids );</div>
<div class="line">    MVT::MvNorm( *B, rhsNorm );</div>
<div class="line">    <span class="keywordflow">if</span> (procVerbose) {</div>
<div class="line">      std::cout&lt;&lt; <span class="stringliteral">&quot;---------- Actual Residuals (normalized) ----------&quot;</span>&lt;&lt;std::endl&lt;&lt;std::endl;</div>
<div class="line">      <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;numrhs; i++) {</div>
<div class="line">        ST actRes = actualResids[i]/rhsNorm[i];</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;Problem &quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot; : \t&quot;</span>&lt;&lt; actRes &lt;&lt;std::endl;</div>
<div class="line">        <span class="keywordflow">if</span> (actRes &gt; tol) badRes = <span class="keyword">true</span>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ret!=<a id="a7" name="a7"></a><a class="code hl_enumvalue" href="namespaceBelos.html#a58f4f203f3b36e10cb1ffd4614bbd18ba6ea972a4ffdcac04da6f3cd6369f22c4">Belos::Converged</a> || badRes) {</div>
<div class="line">      success = <span class="keyword">false</span>;</div>
<div class="line">      <span class="keywordflow">if</span> (procVerbose)</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;End Result: TEST FAILED&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="keywordflow">if</span> (procVerbose)</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;End Result: TEST PASSED&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  TEUCHOS_STANDARD_CATCH_STATEMENTS(verbose, std::cerr, success);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> success ? EXIT_SUCCESS : EXIT_FAILURE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line">  <span class="comment">// run with different ST</span></div>
<div class="line">  <span class="keywordflow">return</span> run&lt;double&gt;(argc,argv);</div>
<div class="line">  <span class="comment">// run&lt;float&gt;(argc,argv); // FAILS</span></div>
<div class="line">}</div>
<div class="ttc" id="aBelosBlockGmresSolMgr_8hpp_html"><div class="ttname"><a href="BelosBlockGmresSolMgr_8hpp.html">BelosBlockGmresSolMgr.hpp</a></div><div class="ttdoc">The Belos::BlockGmresSolMgr provides a solver manager for the BlockGmres linear solver.</div></div>
<div class="ttc" id="aBelosPseudoBlockGmresSolMgr_8hpp_html"><div class="ttname"><a href="BelosPseudoBlockGmresSolMgr_8hpp.html">BelosPseudoBlockGmresSolMgr.hpp</a></div><div class="ttdoc">The Belos::PseudoBlockGmresSolMgr provides a solver manager for the BlockGmres linear solver.</div></div>
<div class="ttc" id="aclassBelos_1_1Operator_html"><div class="ttname"><a href="classBelos_1_1Operator.html">Belos::Operator</a></div><div class="ttdoc">Alternative run-time polymorphic interface for operators.</div><div class="ttdef"><b>Definition</b> <a href="BelosOperator_8hpp_source.html#l00048">BelosOperator.hpp:48</a></div></div>
<div class="ttc" id="anamespaceBelos_html_a2a2aa51a3ef87c278fd43945578b3612a214b85228315388f0b0fea24202ba4e4"><div class="ttname"><a href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a214b85228315388f0b0fea24202ba4e4">Belos::StatusTestDetails</a></div><div class="ttdeci">@ StatusTestDetails</div><div class="ttdef"><b>Definition</b> <a href="BelosTypes_8hpp_source.html#l00229">BelosTypes.hpp:229</a></div></div>
<div class="ttc" id="anamespaceBelos_html_a2a2aa51a3ef87c278fd43945578b3612a54629124d7d6823ab26d8e1df854d962"><div class="ttname"><a href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a54629124d7d6823ab26d8e1df854d962">Belos::TimingDetails</a></div><div class="ttdeci">@ TimingDetails</div><div class="ttdef"><b>Definition</b> <a href="BelosTypes_8hpp_source.html#l00228">BelosTypes.hpp:228</a></div></div>
<div class="ttc" id="anamespaceBelos_html_a2a2aa51a3ef87c278fd43945578b3612a63033b406b3bb6a654a538f9b13e34ec"><div class="ttname"><a href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a63033b406b3bb6a654a538f9b13e34ec">Belos::Errors</a></div><div class="ttdeci">@ Errors</div><div class="ttdef"><b>Definition</b> <a href="BelosTypes_8hpp_source.html#l00223">BelosTypes.hpp:223</a></div></div>
<div class="ttc" id="anamespaceBelos_html_a2a2aa51a3ef87c278fd43945578b3612a7ea40ab539dda8218818a3b391f88ff7"><div class="ttname"><a href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a7ea40ab539dda8218818a3b391f88ff7">Belos::Warnings</a></div><div class="ttdeci">@ Warnings</div><div class="ttdef"><b>Definition</b> <a href="BelosTypes_8hpp_source.html#l00224">BelosTypes.hpp:224</a></div></div>
<div class="ttc" id="anamespaceBelos_html_a2a2aa51a3ef87c278fd43945578b3612a9412d40e3f67e98d566374c3bc2b6439"><div class="ttname"><a href="namespaceBelos.html#a2a2aa51a3ef87c278fd43945578b3612a9412d40e3f67e98d566374c3bc2b6439">Belos::Debug</a></div><div class="ttdeci">@ Debug</div><div class="ttdef"><b>Definition</b> <a href="BelosTypes_8hpp_source.html#l00231">BelosTypes.hpp:230</a></div></div>
<div class="ttc" id="anamespaceBelos_html_a58f4f203f3b36e10cb1ffd4614bbd18b"><div class="ttname"><a href="namespaceBelos.html#a58f4f203f3b36e10cb1ffd4614bbd18b">Belos::ReturnType</a></div><div class="ttdeci">ReturnType</div><div class="ttdoc">Whether the Belos solve converged for all linear systems.</div><div class="ttdef"><b>Definition</b> <a href="BelosTypes_8hpp_source.html#l00123">BelosTypes.hpp:123</a></div></div>
<div class="ttc" id="anamespaceBelos_html_a58f4f203f3b36e10cb1ffd4614bbd18ba6ea972a4ffdcac04da6f3cd6369f22c4"><div class="ttname"><a href="namespaceBelos.html#a58f4f203f3b36e10cb1ffd4614bbd18ba6ea972a4ffdcac04da6f3cd6369f22c4">Belos::Converged</a></div><div class="ttdeci">@ Converged</div><div class="ttdef"><b>Definition</b> <a href="BelosTypes_8hpp_source.html#l00124">BelosTypes.hpp:124</a></div></div>
<div class="ttc" id="anamespaceBelos_html_af5ec042691e0f15dd1b2a66f0eb22679"><div class="ttname"><a href="namespaceBelos.html#af5ec042691e0f15dd1b2a66f0eb22679">Belos::Belos_Version</a></div><div class="ttdeci">std::string Belos_Version()</div><div class="ttdef"><b>Definition</b> <a href="BelosVersion_8cpp_source.html#l00018">BelosVersion.cpp:18</a></div></div>
</div><!-- fragment --> </div><!-- contents -->

<!-- Assumes Doxygen adds the jquery script. Otherwise, uncomment following
     line:
<script type="text/javascript" 
        src="common/parameterList/js/jquery.js"></script> 
-->
<script type="text/javascript" 
        src="common/parameterList/js/iframeResizer.min.js"></script> 
<script type="text/javascript">
iFrameResize({
  log                 : true,   // Enable console logging
  enablePublicMethods : true,   // Enable methods within iframe hosted page
  sizeHeight:true,
  interval: -1,
  resizedCallback     : function(messageData){ // Callback fn when msg recd
    $('p#callback').html(
        '<b>Frame ID:</b> '    + messageData.iframe.id +
        ' <b>Height:</b> '     + messageData.height +
        ' <b>Width:</b> '      + messageData.width +
        ' <b>Event type:</b> ' + messageData.type
     );
  }
});
</script>
<hr size="1"><address style="align: right;"><small>
Generated on Thu Oct 9 2025 20:36:27 for Belos by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.9.8</small></address>
</body>
</html>
