<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EpetraExt: I/O Operations for Epetra Objects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">EpetraExt<span id="projectnumber">&#160;Development</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">I/O Operations for Epetra Objects</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Epetra supports I/O operations for Epetra objects based on </p><ol>
<li>
<a class="el" href="namespaceMatlab.html">Matlab</a> triplet (i,j,value) format for writing and reading of Epetra RowMatrix and Operator objects. </li>
<li>
Matrix Market format: Support writing and reading of Epetra BlockMap, Map, MultiVector, Vector, RowMatrix and Operator objects. </li>
<li>
HDF5 format: Support writing and reading of Epetra BlockMap, Map, MultiVector, Vector, RowMatrix and Operator objects. Available when <a class="el" href="namespaceEpetraExt.html" title="EpetraExt::BlockCrsMatrix: A class for constructing a distributed block matrix.">EpetraExt</a> is configured with <code>--enable-epetraext-hdf5</code>. </li>
<li>
An XML-compatible reader and writer is available when <a class="el" href="namespaceTeuchos.html">Teuchos</a> is configures with &ndash;enable-teuchos-expat. </li>
</ol>
<p>The simplest of the input function is <a class="el" href="namespaceEpetraExt.html#a03a8e77c91c17f9403ca2cdab7feefae" title="Constructs an Epetra_CrsMatrix object from a Matlab format file, distributes rows evenly across proce...">EpetraExt::MatlabFileToCrsMatrix</a>. This function requires only a valid ASCII file containing 1 or more lines where each row is of the form: (row_index, col_index, value) and a valid <a class="elRef" href="../../../epetra/doc/html/classEpetra__Comm.html">Epetra_Comm</a> object. The matrix domain and range maps are assumed to have a size of the maximum row and column index present in the file, respectively, and will be constructed as uniform distributed maps. The row map will be identical to the range map and the column map will be determined by which columns are present for the rows on a given processor.</p>
<p>The simplest output functions are <a class="el" href="namespaceEpetraExt.html#a0237877b4be8a73dff83eb314c8c450f" title="Writes an Epetra_RowMatrix object to a file that is compatible with Matlab.">EpetraExt::RowMatrixToMatlabFile</a> and <a class="el" href="namespaceEpetraExt.html" title="EpetraExt::BlockCrsMatrix: A class for constructing a distributed block matrix.">EpetraExt</a>:OperatorToMatlabFile, which write out any <a class="elRef" href="../../../epetra/doc/html/classEpetra__RowMatrix.html">Epetra_RowMatrix</a> or <a class="elRef" href="../../../epetra/doc/html/classEpetra__Operator.html">Epetra_Operator</a> object, respectively. <a class="elRef" href="../../../epetra/doc/html/classEpetra__Operator.html">Epetra_Operator</a> coefficients are generated by multiplying the operator with the canonical vectors, several at a time for performance reasons.</p>
<p>The I/O function are summarized below:</p>
<ol>
<li>
BlockMap and Map I/O: <ol>
<li>
<a class="el" href="namespaceEpetraExt.html#add3bf2a3fbc2a871ff59a9174e6218ae" title="Constructs an Epetra_BlockMap object from a Matrix Market format file.">EpetraExt::MatrixMarketFileToBlockMap</a> </li>
<li>
<a class="el" href="namespaceEpetraExt.html#a5c40967ea973ff5b0fddd20f945f1ed0" title="Writes an Epetra_BlockMap or Epetra_Map object to a Matrix Market format file.">EpetraExt::BlockMapToMatrixMarketFile</a> </li>
<li>
<a class="el" href="namespaceEpetraExt.html#ac867983fcb84f7a1ed82269d2ea03334" title="Constructs an Epetra_BlockMap object from a Matrix Market format file.">EpetraExt::MatrixMarketFileToMap</a> </li>
</ol>
</li>
<li>
CrsMatrix Input: <ol>
<li>
<a class="el" href="namespaceEpetraExt.html#a03a8e77c91c17f9403ca2cdab7feefae" title="Constructs an Epetra_CrsMatrix object from a Matlab format file, distributes rows evenly across proce...">EpetraExt::MatlabFileToCrsMatrix</a> </li>
<li>
<a class="el" href="namespaceEpetraExt.html#ab712c3c4dfe2cfc28707359e294f6dcb">EpetraExt::MatrixMarketFileToCrsMatrix</a> </li>
</ol>
</li>
<li>
RowMatrix output (includes all Epetra matrix classes): <ol>
<li>
<a class="el" href="namespaceEpetraExt.html#ab0877287bad416bde52f5456ba72d50d" title="Writes an Epetra_RowMatrix object to a Matrix Market format file.">EpetraExt::RowMatrixToMatrixMarketFile</a> </li>
<li>
<a class="el" href="namespaceEpetraExt.html#a0237877b4be8a73dff83eb314c8c450f" title="Writes an Epetra_RowMatrix object to a file that is compatible with Matlab.">EpetraExt::RowMatrixToMatlabFile</a> </li>
</ol>
</li>
<li>
Operator output (includes all Epetra matrix and operator classes): <ol>
<li>
<a class="el" href="namespaceEpetraExt.html#ab0877287bad416bde52f5456ba72d50d" title="Writes an Epetra_RowMatrix object to a Matrix Market format file.">EpetraExt::RowMatrixToMatrixMarketFile</a> </li>
<li>
<a class="el" href="namespaceEpetraExt.html#a0237877b4be8a73dff83eb314c8c450f" title="Writes an Epetra_RowMatrix object to a file that is compatible with Matlab.">EpetraExt::RowMatrixToMatlabFile</a> </li>
</ol>
</li>
<li>
MultiVector and Vector I/O: </li>
<li>
MultiVector and Vector I/O: <ol>
<li>
<a class="el" href="namespaceEpetraExt.html#a0c017886cb91a050da9515989fe05961" title="Constructs an Epetra_MultiVector object from a Matrix Market format file.">EpetraExt::MatrixMarketFileToMultiVector</a> </li>
<li>
<a class="el" href="namespaceEpetraExt.html#a11bc556aa0c7cf3c0702d565f60eba4f" title="Constructs an Epetra_Vector object from a Matrix Market format file.">EpetraExt::MatrixMarketFileToVector</a> </li>
<li>
<a class="el" href="namespaceEpetraExt.html#a8acab33ea282d3d66068b546cc0096b9" title="Writes an Epetra_MultiVector object to a Matrix Market format file.">EpetraExt::MultiVectorToMatrixMarketFile</a> </li>
<li>
<a class="el" href="namespaceEpetraExt.html#ae5fcc7f912710ff21e51ba8c4f94e821" title="Writes an Epetra_Vector object to a Matrix Market format file.">EpetraExt::VectorToMatrixMarketFile</a> </li>
</ol>
</li>
<li>
HDF5 class: <a class="el" href="classEpetraExt_1_1HDF5.html" title="class HDF5: A class for storing Epetra objects in parallel binary files">EpetraExt::HDF5</a> </li>
<li>
XML classes: <a class="el" href="classEpetraExt_1_1XMLReader.html" title="class XMLReader: A class for reading Epetra objects stored in XML files.">EpetraExt::XMLReader</a> and <a class="el" href="classEpetraExt_1_1XMLWriter.html" title="class XMLWriter: A class for writing Trilinos objects to XML files.">EpetraExt::XMLWriter</a>. </li>
</ol>
<p>The following example (from Trilinos/packages/aztecoo/example/AztecOO_Matlab_Input) shows an interesting use of these classes, illustrating how to use these classes in conjunction with AztecOO to write out the coefficients of the inverse of a matrix:</p>
<pre class="fragment">/*
//@HEADER
// ***********************************************************************
// 
//        AztecOO: An Object-Oriented Aztec Linear Solver Package 
//                 Copyright (2002) Sandia Corporation
// 
// Under terms of Contract DE-AC04-94AL85000, there is a non-exclusive
// license for use of this work by or on behalf of the U.S. Government.
// 
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are
// met:
//
// 1. Redistributions of source code must retain the above copyright
// notice, this list of conditions and the following disclaimer.
//
// 2. Redistributions in binary form must reproduce the above copyright
// notice, this list of conditions and the following disclaimer in the
// documentation and/or other materials provided with the distribution.
//
// 3. Neither the name of the Corporation nor the names of the
// contributors may be used to endorse or promote products derived from
// this software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY SANDIA CORPORATION "AS IS" AND ANY
// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
// PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL SANDIA CORPORATION OR THE
// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
// LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// Questions? Contact Michael A. Heroux (maherou@sandia.gov) 
// 
// ***********************************************************************
//@HEADER
*/
#include "AztecOO_config.h"
#ifdef HAVE_MPI
#include "mpi.h"
#include "Epetra_MpiComm.h"
#else
#include "Epetra_SerialComm.h"
#endif
#include "Epetra_Map.h"
#include "Epetra_Vector.h"
#include "Epetra_CrsMatrix.h"
#include "EpetraExt_OperatorOut.h"
#include "EpetraExt_CrsMatrixIn.h"
#include "AztecOO_Operator.h"
#include "Epetra_InvOperator.h"
#include &lt;string&gt;
// prototypes

int checkValues( double x, double y, string message = "", bool verbose = false) { 
  if (fabs((x-y)/x) &gt; 0.01) {
    return(1); 
    if (verbose) cout &lt;&lt; "********** " &lt;&lt; message &lt;&lt; " check failed.********** " &lt;&lt; endl;
  }
  else {
    if (verbose) cout &lt;&lt; message &lt;&lt; " check OK." &lt;&lt; endl;    
    return(0);
  }
}

int main(int argc, char *argv[]) {

#ifdef HAVE_MPI
  MPI_Init(&amp;argc,&amp;argv);
  Epetra_MpiComm comm (MPI_COMM_WORLD);
#else
  Epetra_SerialComm comm;
#endif

  int MyPID = comm.MyPID();

  bool verbose = false;
  bool verbose1 = false; 
  // Check if we should print results to standard out
  if (argc &gt; 1) {
    if ((argv[1][0] == '-') &amp;&amp; (argv[1][1] == 'v')) {
      verbose1 = true;
      if (MyPID==0) verbose = true;
    }
  }

  if (verbose1) cout &lt;&lt; comm &lt;&lt; endl;


  // Uncomment the next three lines to debug in mpi mode
  //int tmp;
  //if (MyPID==0) cin &gt;&gt; tmp;
  //comm.Barrier();

  Epetra_CrsMatrix * A; 
  EPETRA_CHK_ERR(EpetraExt::MatlabFileToCrsMatrix("A.dat", comm, A));

  Epetra_Vector  x(A-&gt;OperatorDomainMap()); 
  Epetra_Vector  b(A-&gt;OperatorRangeMap());
  x.Random();
  A-&gt;Apply(x,b); // Generate RHS from x
  Epetra_Vector xx(x); // Copy x to xx for later use

  Epetra_LinearProblem problem(A, &amp;x, &amp;b);
  // Construct a solver object for this problem

  AztecOO solver(problem);
  solver.SetAztecOption(AZ_precond, AZ_none);
  if (!verbose1) solver.SetAztecOption(AZ_output, AZ_none);
  solver.SetAztecOption(AZ_kspace, A-&gt;NumGlobalRows());
  AztecOO_Operator AOpInv(&amp;solver, A-&gt;NumGlobalRows());
  Epetra_InvOperator AInvOp(&amp;AOpInv);

  EPETRA_CHK_ERR(EpetraExt::OperatorToMatlabFile("Ainv.dat", AInvOp));

  comm.Barrier();

  Epetra_CrsMatrix * AInv; 
  EPETRA_CHK_ERR(EpetraExt::MatlabFileToCrsMatrix("Ainv.dat", comm, AInv));

  EPETRA_CHK_ERR(AInv-&gt;Apply(b,x));

  EPETRA_CHK_ERR(x.Update(1.0, xx, -1.0));
  double residual = 0.0;
  EPETRA_CHK_ERR(x.Norm2(&amp;residual));
  if (verbose) cout &lt;&lt; "Norm of difference between computed x and exact x = " &lt;&lt; residual &lt;&lt; endl;
  int ierr = checkValues(residual,0.0,"Norm of difference between computed A1x1 and A1x1 from file", verbose);

  
  delete A;
  delete AInv;


  #ifdef HAVE_MPI
  MPI_Finalize() ;
#endif

  return(ierr);
}
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 9 2025 20:37:18 for EpetraExt by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
