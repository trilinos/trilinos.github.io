<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NOX: Step 3: Call NOX from your code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">NOX<span id="projectnumber">&#160;Development</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Step 3: Call NOX from your code</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A small example based on the <a class="el" href="namespaceNOX_1_1LAPACK.html" title="NOX BLAS/LAPACK support.">NOX::LAPACK</a> Vector and Group is included with NOX; see the file Trilinos/packages/nox/examples/lapack/NOX_SimpleExamples/Rosenbrock.C.</p>
<p>There are four steps to calling the solver.</p>
<h1><a class="anchor" id="step3_stepa"></a>
Step A: Instantiate a Group object containing the initial guess.</h1>
<p>The first step is to somehow construct an object deriving from the Abstract::Group which contains the initial guess as its x-vector. See <a class="el" href="step2.html">Step 2: Create concrete implementations of the NOX::Abstract classes</a> for more details. For example:</p>
<div class="fragment"><div class="line"><span class="comment">// Construct an object that derives from the abstract Group object. Here</span></div>
<div class="line"><span class="comment">// we call it the ExampleGroup. It should contain the initial guess.</span></div>
<div class="line">Teuchos::RCP&lt;UserConcreteGroup&gt; grp =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> UserConcreteGroup);</div>
</div><!-- fragment --><p>Note that the group is not handled as a raw pointer, but is wrapped in a reference counter smart pointer (RCP). RCPs enforce strict memory management in NOX and LOCA and can prevent many errors that users have encountered with objects going out of scope. We use the RCP implementation in the Trilinos package <a href="http://trilinos.sandia.gov/packages/teuchos">Teuchos</a>. For information on the use of smart pointers, see <a href="http://trilinos.sandia.gov/RefCountPtrBeginnersGuideSAND.pdf">Teuchos Reference Counted Pointer Beginners Guide</a>.</p>
<h1><a class="anchor" id="step3_stepb"></a>
Step B: Construct the status tests</h1>
<p>The <a class="el" href="namespaceNOX_1_1StatusTest.html" title="Status checkers.">NOX::StatusTest</a> objects are used to determine when NOX should terminate the iterative process due to either convergence or failure. For example...</p>
<ul>
<li>The <a class="el" href="classNOX_1_1StatusTest_1_1MaxIters.html" title="Failure test based on the maximum number of nonlinear solver iterations.">NOX::StatusTest::MaxIters</a> test is used to control the maximum number of iterations that the nonlinear solver is allowed to take.</li>
<li>The <a class="el" href="classNOX_1_1StatusTest_1_1NormF.html" title="Various convergence tests based on the norm of the residual.">NOX::StatusTest::NormF</a> test checks the size of <picture><source srcset="form_47_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\| F(x)
  \|$" src="form_47.png" width="38" height="14"/></picture>. This check can be done based on relative or absolute norms, scaled by <picture><source srcset="form_48_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \sqrt{n} $" src="form_48.png" width="18" height="14"/></picture>, and more. See the description for more details.</li>
</ul>
<p>These and other status tests can be combined using the <a class="el" href="classNOX_1_1StatusTest_1_1Combo.html" title="Arbitrary combination of status tests.">NOX::StatusTest::Combo</a> object. It takes an arbitrary number of status tests and either AND's or OR's them together.</p>
<p>Alternatively, users can build a set of status tests from a Teuchos::ParameterList by using the <a class="el" href="classNOX_1_1StatusTest_1_1Factory.html" title="Factory to build a set of status tests from a parameter list.">NOX::StatusTest::Factory</a> object. See <a class="el" href="classNOX_1_1StatusTest_1_1Factory.html" title="Factory to build a set of status tests from a parameter list.">NOX::StatusTest::Factory</a> for parameter list arguments and examples.</p>
<p>Finally, the user can create their own status tests, so long as they derive from <a class="el" href="classNOX_1_1StatusTest_1_1Generic.html" title="Generic status test to check for convergence or failure of the nonlinear solver.">NOX::StatusTest::Generic</a>.</p>
<p>Here is some sample code.</p>
<div class="fragment"><div class="line"><span class="comment">// Set up the status tests</span></div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::NormF&gt; statusTestNormF =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="classNOX_1_1StatusTest_1_1NormF.html">NOX::StatusTest::NormF</a>(1.0e-4));</div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::MaxIters&gt; statusTestMaxIters =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="classNOX_1_1StatusTest_1_1MaxIters.html">NOX::StatusTest::MaxIters</a>(20));</div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::Combo&gt; statusTestsCombo =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="classNOX_1_1StatusTest_1_1Combo.html">NOX::StatusTest::Combo</a>(<a class="code hl_enumvalue" href="classNOX_1_1StatusTest_1_1Combo.html#a788f39025311c7e7fdb1d53660dafe19a6529707f844e7fe814d3fa94a761677f">NOX::StatusTest::Combo::OR</a>,</div>
<div class="line">                                          statusTestNormF,</div>
<div class="line">                                          statusTestMaxIters));</div>
<div class="ttc" id="aclassNOX_1_1StatusTest_1_1Combo_html"><div class="ttname"><a href="classNOX_1_1StatusTest_1_1Combo.html">NOX::StatusTest::Combo</a></div><div class="ttdoc">Arbitrary combination of status tests.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_Combo.H:43</div></div>
<div class="ttc" id="aclassNOX_1_1StatusTest_1_1Combo_html_a788f39025311c7e7fdb1d53660dafe19a6529707f844e7fe814d3fa94a761677f"><div class="ttname"><a href="classNOX_1_1StatusTest_1_1Combo.html#a788f39025311c7e7fdb1d53660dafe19a6529707f844e7fe814d3fa94a761677f">NOX::StatusTest::Combo::OR</a></div><div class="ttdeci">@ OR</div><div class="ttdoc">Logically &quot;OR&quot; together the results of the tests in this combination.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_Combo.H:55</div></div>
<div class="ttc" id="aclassNOX_1_1StatusTest_1_1MaxIters_html"><div class="ttname"><a href="classNOX_1_1StatusTest_1_1MaxIters.html">NOX::StatusTest::MaxIters</a></div><div class="ttdoc">Failure test based on the maximum number of nonlinear solver iterations.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_MaxIters.H:35</div></div>
<div class="ttc" id="aclassNOX_1_1StatusTest_1_1NormF_html"><div class="ttname"><a href="classNOX_1_1StatusTest_1_1NormF.html">NOX::StatusTest::NormF</a></div><div class="ttdoc">Various convergence tests based on the norm of the residual.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_NormF.H:78</div></div>
</div><!-- fragment --><p>This test uses an OR combination, meaning that either test registered with the Combo test can trigger termination. The first test requires that the norm of the residual is less that 1.0e-4. If met, NOX will terminate returning a "Converged" result. The second test will trigger NOX to terminate if a maximum number of iterations is reached and return a "Failed" result.</p>
<h1><a class="anchor" id="step3_stepc"></a>
Step C: Set the solver parameters</h1>
<p>Next, we set up a parameter list containing the information on what types of solvers and so forth should be used.</p>
<div class="fragment"><div class="line"><span class="comment">// Create the list of solver parameters</span></div>
<div class="line">Teuchos::RCP&lt;Teuchos::ParameterList&gt; solverParametersPtr =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> Teuchos::ParameterList);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Select the solver (this is the default)</span></div>
<div class="line">solverParametersPtr-&gt;set(<span class="stringliteral">&quot;Nonlinear Solver&quot;</span>, <span class="stringliteral">&quot;Line Search Based&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create the line search parameters sublist</span></div>
<div class="line">Teuchos::ParameterList&amp; lineSearchParameters = solverParametersPtr-&gt;sublist(<span class="stringliteral">&quot;Line Search&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the line search method</span></div>
<div class="line">lineSearchParameters.set(<span class="stringliteral">&quot;Method&quot;</span>,<span class="stringliteral">&quot;More&#39;-Thuente&quot;</span>);</div>
</div><!-- fragment --><p>For a full list of parameters; see <a class="el" href="parameters.html">NOX Parameter Reference Page</a>.</p>
<h1><a class="anchor" id="step3_stepd"></a>
Step D: Construct the solver and solve</h1>
<p>The last step is to create the solver, passing in the group with the initial guess, the status tests, and the solver parameters.</p>
<div class="fragment"><div class="line"><span class="comment">// Create the solver</span></div>
<div class="line">Teuchos::RCP&lt;NOX::Solver::Generic&gt; solver =</div>
<div class="line">  NOX::Solver::buildSolver(grp, statusTestsCombo, solverParametersPtr);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Solve the nonlinear system</span></div>
<div class="line"><a class="code hl_enumeration" href="namespaceNOX_1_1StatusTest.html#aa46b1f439192e784b8434b16a99665e1">NOX::StatusTest::StatusType</a> status = solver-&gt;solve();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print the parameter list</span></div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; <span class="stringliteral">&quot;-- Parameter List From Solver --&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">solver-&gt;getList().print(cout);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the answer</span></div>
<div class="line">grp = solver-&gt;getSolutionGroup();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print the answer</span></div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; <span class="stringliteral">&quot;-- Final Solution From Solver --&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">grp.printSolution();</div>
<div class="ttc" id="anamespaceNOX_1_1StatusTest_html_aa46b1f439192e784b8434b16a99665e1"><div class="ttname"><a href="namespaceNOX_1_1StatusTest.html#aa46b1f439192e784b8434b16a99665e1">NOX::StatusTest::StatusType</a></div><div class="ttdeci">StatusType</div><div class="ttdoc">Status type.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_Generic.H:28</div></div>
</div><!-- fragment --><h1><a class="anchor" id="step3_problems"></a>
If you have problems...</h1>
<p>Please report any issues regarding NOX and LOCA to <a href="http://software.sandia.gov/bugzilla/">Bugzilla</a>; see <a class="el" href="index.html#bugs">Reporting Bugs and Making Enhancement Requests</a> for more information.</p>
<h1><a class="anchor" id="step3_moving_on"></a>
Moving on...</h1>
<p>Go on to <a class="el" href="step4.html">Step 4: Link your code to NOX</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 9 2025 20:46:01 for NOX by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
