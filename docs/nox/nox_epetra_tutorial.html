<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NOX: NOX Epetra Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">NOX<span id="projectnumber">&#160;Development</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">NOX Epetra Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes how to write the main file for using NOX's Epetra implementation of the Group and Vector.</p>
<p>This example can be found in Trilinos/packages/nox/test/epetra/1Dfem/1Dfem.C</p>
<p>Begin by including the NOX library header files and any other headers needed by your application:</p>
<div class="fragment"><div class="line"><span class="comment">// NOX Objects</span></div>
<div class="line"><span class="preprocessor">#include &quot;NOX.H&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;NOX_Epetra.H&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Epetra Objects</span></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_MpiComm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_SerialComm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_Map.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_Vector.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_RowMatrix.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_CrsMatrix.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_Map.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Epetra_LinearProblem.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// User&#39;s application specific files</span></div>
<div class="line"><span class="preprocessor">#include &quot;1DfemInterface.H&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;1DfemPrePostOperator.H&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;Teuchos_ParameterList.hpp&quot;</span></div>
</div><!-- fragment --><p>For convenience define the following:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>std;</div>
</div><!-- fragment --><p>Begin by initializing MPI (if building a parallel version) and create the Epetra communicator for MPI. In this case autoconf defines the flag HAVE_MPI if we are building a parallel version.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialize MPI</span></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line">  MPI_Init(&amp;argc,&amp;argv);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a communicator for Epetra objects</span></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line">  Epetra_MpiComm Comm( NOX::get_global_comm() );</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  Epetra_SerialComm Comm;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>Setup some initial values.</p>
<div class="fragment"><div class="line"><span class="comment">// Get the process ID and the total number of processors</span></div>
<div class="line"><span class="keywordtype">int</span> MyPID = Comm.MyPID();</div>
<div class="line"><span class="keywordtype">int</span> NumProc = Comm.NumProc();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check verbosity level</span></div>
<div class="line"><span class="keywordtype">bool</span> verbose = <span class="keyword">false</span>;</div>
<div class="line"><span class="keywordflow">if</span> (argc &gt; 1)</div>
<div class="line">  <span class="keywordflow">if</span> (argv[1][0]==<span class="charliteral">&#39;-&#39;</span> &amp;&amp; argv[1][1]==<span class="charliteral">&#39;v&#39;</span>)</div>
<div class="line">    verbose = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the number of elements from the command line</span></div>
<div class="line"><span class="keywordtype">int</span> NumGlobalElements = 0;</div>
<div class="line"><span class="keywordflow">if</span> ((argc &gt; 2) &amp;&amp; (verbose))</div>
<div class="line">  NumGlobalElements = atoi(argv[2]) + 1;</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> ((argc &gt; 1) &amp;&amp; (!verbose))</div>
<div class="line">  NumGlobalElements = atoi(argv[1]) + 1;</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  NumGlobalElements = 101;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The number of unknowns must be at least equal to the</span></div>
<div class="line"><span class="comment">// number of processors.</span></div>
<div class="line"><span class="keywordflow">if</span> (NumGlobalElements &lt; NumProc) {</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;numGlobalBlocks = &quot;</span> &lt;&lt; NumGlobalElements</div>
<div class="line">   &lt;&lt; <span class="stringliteral">&quot; cannot be &lt; number of processors = &quot;</span> &lt;&lt; NumProc &lt;&lt; std::endl;</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;Test failed!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;NOX Error&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Create your object that derives from <a class="el" href="class_n_o_x_1_1_epetra_1_1_interface_1_1_required.html" title="Supplies NOX with the set nonlinear equations.">NOX::Epetra::Interface::Required</a> so that nox has access to the set of nonlinear equations to solve.</p>
<div class="fragment"><div class="line"><span class="comment">// Create the interface between NOX and the application</span></div>
<div class="line"><span class="comment">// This object is derived from NOX::Epetra::Interface</span></div>
<div class="line">Teuchos::RCP&lt;Interface&gt; <span class="keyword">interface </span>=</div>
<div class="line">  Teuchos::rcp(new Interface(NumGlobalElements, Comm));</div>
</div><!-- fragment --><p>Grab the initial guess vector and initialize it and the interface object.</p>
<div class="fragment"><div class="line"><span class="comment">// Get the vector from the Problem</span></div>
<div class="line">Teuchos::RCP&lt;Epetra_Vector&gt; soln = interface-&gt;getSolution();</div>
<div class="line">Teuchos::RCP&lt;NOX::Epetra::Vector&gt; noxSoln =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_vector.html">NOX::Epetra::Vector</a>(soln,</div>
<div class="line">                   <a class="code hl_enumvalue" href="class_n_o_x_1_1_epetra_1_1_vector.html#ac730e39819e3cfcb5e71d835ccbc4177a0d4f8ab43f33e41813e4d79cb788f878">NOX::Epetra::Vector::CreateView</a>));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the PDE factor (for nonlinear forcing term).  This could be specified</span></div>
<div class="line"><span class="comment">// via user input.</span></div>
<div class="line">interface-&gt;setPDEfactor(1000.0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the initial guess</span></div>
<div class="line">soln-&gt;PutScalar(1.0);</div>
<div class="ttc" id="aclass_n_o_x_1_1_epetra_1_1_vector_html"><div class="ttname"><a href="class_n_o_x_1_1_epetra_1_1_vector.html">NOX::Epetra::Vector</a></div><div class="ttdoc">Implementation of NOX::Abstract::Vector for Epetra vectors.</div><div class="ttdef"><b>Definition</b> NOX_Epetra_Vector.H:31</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_epetra_1_1_vector_html_ac730e39819e3cfcb5e71d835ccbc4177a0d4f8ab43f33e41813e4d79cb788f878"><div class="ttname"><a href="class_n_o_x_1_1_epetra_1_1_vector.html#ac730e39819e3cfcb5e71d835ccbc4177a0d4f8ab43f33e41813e4d79cb788f878">NOX::Epetra::Vector::CreateView</a></div><div class="ttdeci">@ CreateView</div><div class="ttdoc">Keeps a pointer to and uses the actual Epetra_Vector passed in.</div><div class="ttdef"><b>Definition</b> NOX_Epetra_Vector.H:38</div></div>
</div><!-- fragment --><p>Create a parameter list and choose the options for the NOX solver. Note that the linear solver parameters in teh "Linear Solver" sublist are dependent upon what <a class="el" href="class_n_o_x_1_1_epetra_1_1_linear_system.html" title="Pure virtual class interface for allowing different linear solvers to be used by the NOX::Epetra::Gro...">NOX::Epetra::LinearSystem</a> object you are using. Currently NOX only comes with one concrete linear system implementation: NOX::EpetraLinearSystemAztecOO.</p>
<div class="fragment"><div class="line"><span class="comment">// Begin Nonlinear Solver ************************************</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create the top level parameter list</span></div>
<div class="line">Teuchos::RCP&lt;Teuchos::ParameterList&gt; nlParamsPtr =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> Teuchos::ParameterList);</div>
<div class="line">Teuchos::ParameterList&amp; nlParams = *(nlParamsPtr.get());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the nonlinear solver method</span></div>
<div class="line">nlParams.set(<span class="stringliteral">&quot;Nonlinear Solver&quot;</span>, <span class="stringliteral">&quot;Line Search Based&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the printing parameters in the &quot;Printing&quot; sublist</span></div>
<div class="line">Teuchos::ParameterList&amp; printParams = nlParams.sublist(<span class="stringliteral">&quot;Printing&quot;</span>);</div>
<div class="line">printParams.set(<span class="stringliteral">&quot;MyPID&quot;</span>, MyPID);</div>
<div class="line">printParams.set(<span class="stringliteral">&quot;Output Precision&quot;</span>, 3);</div>
<div class="line">printParams.set(<span class="stringliteral">&quot;Output Processor&quot;</span>, 0);</div>
<div class="line"><span class="keywordflow">if</span> (verbose)</div>
<div class="line">  printParams.set(<span class="stringliteral">&quot;Output Information&quot;</span>,</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a25b135dc9f7c5b6fc0b9ce8171643e8b">NOX::Utils::OuterIteration</a> +</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856adcc5226edb211cfed7b7e79de7c578a9">NOX::Utils::OuterIterationStatusTest</a> +</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a119da0cce22656f16f1aac7400bd3b2a">NOX::Utils::InnerIteration</a> +</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a2cccd5434d2ee60fe6149d4828091477">NOX::Utils::LinearSolverDetails</a> +</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a692c04bea8f81df684acfd207ff5feda">NOX::Utils::Parameters</a> +</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856aee8024a0699f0981c126dd5a2619959b">NOX::Utils::Details</a> +</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a460d575464fc6e5c6fd43abd62bc7cf3">NOX::Utils::Warning</a> +</div>
<div class="line">                           <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856ad7aa2fe60425576ca404b100c64795fa">NOX::Utils::Debug</a> +</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856abc545e5a9aa8c2b5d28f0a180d0b3213">NOX::Utils::TestDetails</a> +</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a70f12508894f21ce2816873de343bb1d">NOX::Utils::Error</a>);</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  printParams.set(<span class="stringliteral">&quot;Output Information&quot;</span>, <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a70f12508894f21ce2816873de343bb1d">NOX::Utils::Error</a> +</div>
<div class="line">               <a class="code hl_enumvalue" href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856abc545e5a9aa8c2b5d28f0a180d0b3213">NOX::Utils::TestDetails</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Sublist for line search</span></div>
<div class="line">Teuchos::ParameterList&amp; searchParams = nlParams.sublist(<span class="stringliteral">&quot;Line Search&quot;</span>);</div>
<div class="line">searchParams.set(<span class="stringliteral">&quot;Method&quot;</span>, <span class="stringliteral">&quot;Full Step&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Sublist for direction</span></div>
<div class="line">Teuchos::ParameterList&amp; dirParams = nlParams.sublist(<span class="stringliteral">&quot;Direction&quot;</span>);</div>
<div class="line">dirParams.set(<span class="stringliteral">&quot;Method&quot;</span>, <span class="stringliteral">&quot;Newton&quot;</span>);</div>
<div class="line">Teuchos::ParameterList&amp; newtonParams = dirParams.sublist(<span class="stringliteral">&quot;Newton&quot;</span>);</div>
<div class="line">  newtonParams.set(<span class="stringliteral">&quot;Forcing Term Method&quot;</span>, <span class="stringliteral">&quot;Constant&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Sublist for linear solver for the Newton method</span></div>
<div class="line">Teuchos::ParameterList&amp; lsParams = newtonParams.sublist(<span class="stringliteral">&quot;Linear Solver&quot;</span>);</div>
<div class="line">lsParams.set(<span class="stringliteral">&quot;Aztec Solver&quot;</span>, <span class="stringliteral">&quot;GMRES&quot;</span>);</div>
<div class="line">lsParams.set(<span class="stringliteral">&quot;Max Iterations&quot;</span>, 800);</div>
<div class="line">lsParams.set(<span class="stringliteral">&quot;Tolerance&quot;</span>, 1e-4);</div>
<div class="line">lsParams.set(<span class="stringliteral">&quot;Preconditioner&quot;</span>, <span class="stringliteral">&quot;New Ifpack&quot;</span>);</div>
<div class="line">lsParams.set(<span class="stringliteral">&quot;Preconditioner Reuse Policy&quot;</span>, <span class="stringliteral">&quot;Reuse&quot;</span>);</div>
<div class="line">lsParams.set(<span class="stringliteral">&quot;Max Age Of Prec&quot;</span>, 5);</div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856a119da0cce22656f16f1aac7400bd3b2a"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a119da0cce22656f16f1aac7400bd3b2a">NOX::Utils::InnerIteration</a></div><div class="ttdeci">@ InnerIteration</div><div class="ttdoc">2^2</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:111</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856a25b135dc9f7c5b6fc0b9ce8171643e8b"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a25b135dc9f7c5b6fc0b9ce8171643e8b">NOX::Utils::OuterIteration</a></div><div class="ttdeci">@ OuterIteration</div><div class="ttdoc">2^1</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:109</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856a2cccd5434d2ee60fe6149d4828091477"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a2cccd5434d2ee60fe6149d4828091477">NOX::Utils::LinearSolverDetails</a></div><div class="ttdeci">@ LinearSolverDetails</div><div class="ttdoc">2^6</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:119</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856a460d575464fc6e5c6fd43abd62bc7cf3"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a460d575464fc6e5c6fd43abd62bc7cf3">NOX::Utils::Warning</a></div><div class="ttdeci">@ Warning</div><div class="ttdoc">2^0</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:107</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856a692c04bea8f81df684acfd207ff5feda"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a692c04bea8f81df684acfd207ff5feda">NOX::Utils::Parameters</a></div><div class="ttdeci">@ Parameters</div><div class="ttdoc">2^3</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:113</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856a70f12508894f21ce2816873de343bb1d"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856a70f12508894f21ce2816873de343bb1d">NOX::Utils::Error</a></div><div class="ttdeci">@ Error</div><div class="ttdoc">Errors are always printed.</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:105</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856abc545e5a9aa8c2b5d28f0a180d0b3213"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856abc545e5a9aa8c2b5d28f0a180d0b3213">NOX::Utils::TestDetails</a></div><div class="ttdeci">@ TestDetails</div><div class="ttdoc">2^7</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:121</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856ad7aa2fe60425576ca404b100c64795fa"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856ad7aa2fe60425576ca404b100c64795fa">NOX::Utils::Debug</a></div><div class="ttdeci">@ Debug</div><div class="ttdoc">2^12</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:129</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856adcc5226edb211cfed7b7e79de7c578a9"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856adcc5226edb211cfed7b7e79de7c578a9">NOX::Utils::OuterIterationStatusTest</a></div><div class="ttdeci">@ OuterIterationStatusTest</div><div class="ttdoc">2^5</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:117</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_utils_html_ab30f60438649426b2490e4646754c856aee8024a0699f0981c126dd5a2619959b"><div class="ttname"><a href="class_n_o_x_1_1_utils.html#ab30f60438649426b2490e4646754c856aee8024a0699f0981c126dd5a2619959b">NOX::Utils::Details</a></div><div class="ttdeci">@ Details</div><div class="ttdoc">2^4</div><div class="ttdef"><b>Definition</b> NOX_Utils.H:115</div></div>
</div><!-- fragment --><p>Optionally the user can define methods that will be called before and after each nonlineaer iteration and before and after each nonlinear solve. This is done by creating an object derived from NOX::Abstract::PrePostOperator.</p>
<div class="fragment"><div class="line"><span class="comment">// Add a user defined pre/post operator object</span></div>
<div class="line">Teuchos::RCP&lt;NOX::Abstract::PrePostOperator&gt; ppo =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> UserPrePostOperator(printing));</div>
<div class="line">nlParams.sublist(<span class="stringliteral">&quot;Solver Options&quot;</span>).set(<span class="stringliteral">&quot;User Defined Pre/Post Operator&quot;</span>,</div>
<div class="line">                   ppo);</div>
</div><!-- fragment --><p>Set the status test check option.</p>
<div class="fragment"><div class="line"><span class="comment">// Let&#39;s force all status tests to do a full check</span></div>
<div class="line">nlParams.sublist(<span class="stringliteral">&quot;Solver Options&quot;</span>).</div>
<div class="line">  set(<span class="stringliteral">&quot;Status Test Check Type&quot;</span>, <a class="code hl_enumvalue" href="namespace_n_o_x_1_1_status_test.html#a7c9d9087fff0cfe208e9edc1603ab14ea83970a3e0659ad53f7fea353e46e0878">NOX::StatusTest::Complete</a>);</div>
<div class="ttc" id="anamespace_n_o_x_1_1_status_test_html_a7c9d9087fff0cfe208e9edc1603ab14ea83970a3e0659ad53f7fea353e46e0878"><div class="ttname"><a href="namespace_n_o_x_1_1_status_test.html#a7c9d9087fff0cfe208e9edc1603ab14ea83970a3e0659ad53f7fea353e46e0878">NOX::StatusTest::Complete</a></div><div class="ttdeci">@ Complete</div><div class="ttdoc">Evaluate every test and subtest.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_Generic.H:43</div></div>
</div><!-- fragment --><p>Create a Jacobian-Free Newton-Krylov method by using a <a class="el" href="class_n_o_x_1_1_epetra_1_1_matrix_free.html" title="Concrete implementation for creating an Epetra_Operator Jacobian based on the Matrix-Free Newton-Kryl...">NOX::Epetra::MatrixFree</a> operator for the Jacobian.</p>
<div class="fragment"><div class="line"><span class="comment">// 2. Matrix-Free (Epetra_Operator)</span></div>
<div class="line">Teuchos::RCP&lt;NOX::Epetra::MatrixFree&gt; MF =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_matrix_free.html">NOX::Epetra::MatrixFree</a>(printParams, interface,</div>
<div class="line">                       *noxSoln));</div>
<div class="ttc" id="aclass_n_o_x_1_1_epetra_1_1_matrix_free_html"><div class="ttname"><a href="class_n_o_x_1_1_epetra_1_1_matrix_free.html">NOX::Epetra::MatrixFree</a></div><div class="ttdoc">Concrete implementation for creating an Epetra_Operator Jacobian based on the Matrix-Free Newton-Kryl...</div><div class="ttdef"><b>Definition</b> NOX_Epetra_MatrixFree.H:63</div></div>
</div><!-- fragment --><p>Create a Finite Difference operator to estimate the Jacobian matrix for preconditioning.</p>
<div class="fragment"><div class="line"><span class="comment">// 3. Finite Difference (Epetra_RowMatrix)</span></div>
<div class="line">Teuchos::RCP&lt;NOX::Epetra::FiniteDifference&gt; FD =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_finite_difference.html">NOX::Epetra::FiniteDifference</a>(printParams, interface,</div>
<div class="line">                         *soln));</div>
<div class="ttc" id="aclass_n_o_x_1_1_epetra_1_1_finite_difference_html"><div class="ttname"><a href="class_n_o_x_1_1_epetra_1_1_finite_difference.html">NOX::Epetra::FiniteDifference</a></div><div class="ttdoc">Concrete implementation for creating an Epetra_RowMatrix Jacobian via finite differencing of the resi...</div><div class="ttdef"><b>Definition</b> NOX_Epetra_FiniteDifference.H:74</div></div>
</div><!-- fragment --><p>Create a linear system derived from <a class="el" href="class_n_o_x_1_1_epetra_1_1_linear_system.html" title="Pure virtual class interface for allowing different linear solvers to be used by the NOX::Epetra::Gro...">NOX::Epetra::LinearSystem</a>. <a class="el" href="namespace_n_o_x.html" title="Nonlinear solvers package namespace.">NOX</a> comes with a concrete implementation of the linear system class that uses AztecOO as the linear solver called <a class="el" href="class_n_o_x_1_1_epetra_1_1_linear_system_aztec_o_o.html" title="Concrete implementation of NOX::Epetra::LinearSolver for AztecOO.">NOX::Epetra::LinearSystemAztecOO</a>. In this case we will use the constructor that specifies the Jacobian operator and a preconditioner matrix to be used with an internally constructed AztecOO preconditioner.</p>
<div class="fragment"><div class="line"><span class="comment">// Create the linear system</span></div>
<div class="line">Teuchos::RCP&lt;NOX::Epetra::Interface::Jacobian&gt; iJac = MF;</div>
<div class="line">Teuchos::RCP&lt;NOX::Epetra::Interface::Preconditioner&gt; iPrec = FD;</div>
<div class="line">Teuchos::RCP&lt;NOX::Epetra::LinearSystemAztecOO&gt; linSys =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_linear_system_aztec_o_o.html">NOX::Epetra::LinearSystemAztecOO</a>(printParams, lsParams,</div>
<div class="line">                            iJac, MF,</div>
<div class="line">                            iPrec, FD,</div>
<div class="line">                            *soln));</div>
<div class="ttc" id="aclass_n_o_x_1_1_epetra_1_1_linear_system_aztec_o_o_html"><div class="ttname"><a href="class_n_o_x_1_1_epetra_1_1_linear_system_aztec_o_o.html">NOX::Epetra::LinearSystemAztecOO</a></div><div class="ttdoc">Concrete implementation of NOX::Epetra::LinearSolver for AztecOO.</div><div class="ttdef"><b>Definition</b> NOX_Epetra_LinearSystem_AztecOO.H:283</div></div>
</div><!-- fragment --><p>Create the group using the linear system.</p>
<div class="fragment"><div class="line"><span class="comment">// Create the Group</span></div>
<div class="line"><a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_vector.html">NOX::Epetra::Vector</a> initialGuess(soln, <a class="code hl_enumvalue" href="class_n_o_x_1_1_epetra_1_1_vector.html#ac730e39819e3cfcb5e71d835ccbc4177a0d4f8ab43f33e41813e4d79cb788f878">NOX::Epetra::Vector::CreateView</a>);</div>
<div class="line">Teuchos::RCP&lt;NOX::Epetra::Group&gt; grpPtr =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_group.html">NOX::Epetra::Group</a>(printParams,</div>
<div class="line">                  iReq,</div>
<div class="line">                  initialGuess,</div>
<div class="line">                  linSys));</div>
<div class="line"><a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_group.html">NOX::Epetra::Group</a>&amp; grp = *grpPtr;</div>
<div class="ttc" id="aclass_n_o_x_1_1_epetra_1_1_group_html"><div class="ttname"><a href="class_n_o_x_1_1_epetra_1_1_group.html">NOX::Epetra::Group</a></div><div class="ttdoc">Concrete implementation of NOX::Abstract::Group for Trilinos/Epetra.</div><div class="ttdef"><b>Definition</b> NOX_Epetra_Group.H:49</div></div>
</div><!-- fragment --><p>Create the status tests to determine how to terminate the nonlinear solve.</p>
<div class="fragment"><div class="line"><span class="comment">// Create the convergence tests</span></div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::NormF&gt; absresid =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_status_test_1_1_norm_f.html">NOX::StatusTest::NormF</a>(1.0e-8));</div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::NormF&gt; relresid =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_status_test_1_1_norm_f.html">NOX::StatusTest::NormF</a>(grp, 1.0e-2));</div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::NormUpdate&gt; update =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_status_test_1_1_norm_update.html">NOX::StatusTest::NormUpdate</a>(1.0e-5));</div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::NormWRMS&gt; wrms =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_status_test_1_1_norm_w_r_m_s.html">NOX::StatusTest::NormWRMS</a>(1.0e-2, 1.0e-8));</div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::Combo&gt; converged =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_status_test_1_1_combo.html">NOX::StatusTest::Combo</a>(<a class="code hl_enumvalue" href="class_n_o_x_1_1_status_test_1_1_combo.html#a788f39025311c7e7fdb1d53660dafe19aa380ddc0d8632558ac0485dbba21ea92">NOX::StatusTest::Combo::AND</a>));</div>
<div class="line">converged-&gt;addStatusTest(absresid);</div>
<div class="line">converged-&gt;addStatusTest(relresid);</div>
<div class="line">converged-&gt;addStatusTest(wrms);</div>
<div class="line">converged-&gt;addStatusTest(update);</div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::MaxIters&gt; maxiters =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_status_test_1_1_max_iters.html">NOX::StatusTest::MaxIters</a>(20));</div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::FiniteValue&gt; fv =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_status_test_1_1_finite_value.html">NOX::StatusTest::FiniteValue</a>);</div>
<div class="line">Teuchos::RCP&lt;NOX::StatusTest::Combo&gt; combo =</div>
<div class="line">  Teuchos::rcp(<span class="keyword">new</span> <a class="code hl_class" href="class_n_o_x_1_1_status_test_1_1_combo.html">NOX::StatusTest::Combo</a>(<a class="code hl_enumvalue" href="class_n_o_x_1_1_status_test_1_1_combo.html#a788f39025311c7e7fdb1d53660dafe19a6529707f844e7fe814d3fa94a761677f">NOX::StatusTest::Combo::OR</a>));</div>
<div class="line">combo-&gt;addStatusTest(fv);</div>
<div class="line">combo-&gt;addStatusTest(converged);</div>
<div class="line">combo-&gt;addStatusTest(maxiters);</div>
<div class="ttc" id="aclass_n_o_x_1_1_status_test_1_1_combo_html"><div class="ttname"><a href="class_n_o_x_1_1_status_test_1_1_combo.html">NOX::StatusTest::Combo</a></div><div class="ttdoc">Arbitrary combination of status tests.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_Combo.H:43</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_status_test_1_1_combo_html_a788f39025311c7e7fdb1d53660dafe19a6529707f844e7fe814d3fa94a761677f"><div class="ttname"><a href="class_n_o_x_1_1_status_test_1_1_combo.html#a788f39025311c7e7fdb1d53660dafe19a6529707f844e7fe814d3fa94a761677f">NOX::StatusTest::Combo::OR</a></div><div class="ttdeci">@ OR</div><div class="ttdoc">Logically &quot;OR&quot; together the results of the tests in this combination.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_Combo.H:55</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_status_test_1_1_combo_html_a788f39025311c7e7fdb1d53660dafe19aa380ddc0d8632558ac0485dbba21ea92"><div class="ttname"><a href="class_n_o_x_1_1_status_test_1_1_combo.html#a788f39025311c7e7fdb1d53660dafe19aa380ddc0d8632558ac0485dbba21ea92">NOX::StatusTest::Combo::AND</a></div><div class="ttdeci">@ AND</div><div class="ttdoc">Logically &quot;AND&quot; together the results of the tests in this combination.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_Combo.H:53</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_status_test_1_1_finite_value_html"><div class="ttname"><a href="class_n_o_x_1_1_status_test_1_1_finite_value.html">NOX::StatusTest::FiniteValue</a></div><div class="ttdoc">Failure test based on whether the norm of a vector has a finite value.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_FiniteValue.H:34</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_status_test_1_1_max_iters_html"><div class="ttname"><a href="class_n_o_x_1_1_status_test_1_1_max_iters.html">NOX::StatusTest::MaxIters</a></div><div class="ttdoc">Failure test based on the maximum number of nonlinear solver iterations.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_MaxIters.H:35</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_status_test_1_1_norm_f_html"><div class="ttname"><a href="class_n_o_x_1_1_status_test_1_1_norm_f.html">NOX::StatusTest::NormF</a></div><div class="ttdoc">Various convergence tests based on the norm of the residual.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_NormF.H:78</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_status_test_1_1_norm_update_html"><div class="ttname"><a href="class_n_o_x_1_1_status_test_1_1_norm_update.html">NOX::StatusTest::NormUpdate</a></div><div class="ttdoc">Various convergence tests based on the norm of the change in the solution vector, ,...</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_NormUpdate.H:87</div></div>
<div class="ttc" id="aclass_n_o_x_1_1_status_test_1_1_norm_w_r_m_s_html"><div class="ttname"><a href="class_n_o_x_1_1_status_test_1_1_norm_w_r_m_s.html">NOX::StatusTest::NormWRMS</a></div><div class="ttdoc">Convergence test based on the weighted root mean square norm fo the solution update between iteration...</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_NormWRMS.H:113</div></div>
</div><!-- fragment --><p>Create the solver and solve the problem</p>
<div class="fragment"><div class="line"><span class="comment">// Create the solver</span></div>
<div class="line">Teuchos::RCP&lt;NOX::Solver::Generic&gt; solver =</div>
<div class="line">  NOX::Solver::buildSolver(grpPtr, combo, nlParamsPtr);</div>
<div class="line"><a class="code hl_enumeration" href="namespace_n_o_x_1_1_status_test.html#aa46b1f439192e784b8434b16a99665e1">NOX::StatusTest::StatusType</a> solvStatus = solver-&gt;solve();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// End Nonlinear Solver **************************************</span></div>
<div class="ttc" id="anamespace_n_o_x_1_1_status_test_html_aa46b1f439192e784b8434b16a99665e1"><div class="ttname"><a href="namespace_n_o_x_1_1_status_test.html#aa46b1f439192e784b8434b16a99665e1">NOX::StatusTest::StatusType</a></div><div class="ttdeci">StatusType</div><div class="ttdoc">Status type.</div><div class="ttdef"><b>Definition</b> NOX_StatusTest_Generic.H:28</div></div>
</div><!-- fragment --><p>Get the underlying solution vector in terms of an Epetra_Vector and do whatever you want with it.</p>
<div class="fragment"><div class="line"><span class="comment">// Get the Epetra_Vector with the final solution from the solver</span></div>
<div class="line"><span class="keyword">const</span> <a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_group.html">NOX::Epetra::Group</a>&amp; finalGroup =</div>
<div class="line">  <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_group.html">NOX::Epetra::Group</a>&amp;<span class="keyword">&gt;</span>(solver-&gt;getSolutionGroup());</div>
<div class="line"><span class="keyword">const</span> Epetra_Vector&amp; finalSolution =</div>
<div class="line">  (<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code hl_class" href="class_n_o_x_1_1_epetra_1_1_vector.html">NOX::Epetra::Vector</a>&amp;<span class="keyword">&gt;</span>(finalGroup.<a class="code hl_function" href="class_n_o_x_1_1_epetra_1_1_group.html#a3b8f9860818e4f33c526bd6afa3d55a6">getX</a>())).</div>
<div class="line">  getEpetraVector();</div>
<div class="ttc" id="aclass_n_o_x_1_1_epetra_1_1_group_html_a3b8f9860818e4f33c526bd6afa3d55a6"><div class="ttname"><a href="class_n_o_x_1_1_epetra_1_1_group.html#a3b8f9860818e4f33c526bd6afa3d55a6">NOX::Epetra::Group::getX</a></div><div class="ttdeci">virtual const NOX::Abstract::Vector &amp; getX() const</div><div class="ttdoc">Return solution vector.</div><div class="ttdef"><b>Definition</b> NOX_Epetra_Group.C:512</div></div>
</div><!-- fragment --><p>Exit simulation.</p>
<div class="fragment"><div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
