<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tempus: 03_Intro_SolutionState.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tempus<span id="projectnumber">&#160;Version of the Day</span>
   </div>
   <div id="projectbrief">Time Integration</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">examples</a></li><li class="navelem"><a class="el" href="dir_5055d0dc3a83138eeed906e67f5842e7.html">03_Intro_SolutionState</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">03_Intro_SolutionState.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;iomanip&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;Teuchos_StandardCatchMacros.hpp&quot;</code><br />
<code>#include &quot;Thyra_VectorStdOps.hpp&quot;</code><br />
<code>#include &quot;Thyra_DefaultSpmdVectorSpace.hpp&quot;</code><br />
<code>#include &quot;Thyra_DetachedVectorView.hpp&quot;</code><br />
<code>#include &quot;<a class="el" href="VanDerPol__ModelEvaluator__02_8hpp_source.html">../02_Use_ModelEvaluator/VanDerPol_ModelEvaluator_02.hpp</a>&quot;</code><br />
<code>#include &quot;Tempus_SolutionState.hpp&quot;</code><br />
</div>
<p><a href="03__Intro__SolutionState_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97" id="r_a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="03__Intro__SolutionState_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="memdesc:a0ddf1224851353fc92bfbff6f499fa97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Description:  <br /></td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0ddf1224851353fc92bfbff6f499fa97" name="a0ddf1224851353fc92bfbff6f499fa97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ddf1224851353fc92bfbff6f499fa97">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Description: </p>
<h1><a class="anchor" id="example-03"></a>
Example 3: Introduce SolutionState</h1>
<p>The basic idea behind the SolutionState object is that it contains all the information about the solution at a particular time, i.e., <picture><source srcset="form_5_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$x(t)$" src="form_5.png" width="21" height="14"/></picture>. The primary requirement for SolutionState is that it contains all the information needed to restart the solution from scratch, e.g., check-pointing and recover from a failed timestep. The four primary components of the <a class="el" href="classTempus_1_1SolutionState.html" title="Solution state for integrators and steppers.">Tempus::SolutionState</a> are</p><ul>
<li>The state - <picture><source srcset="form_5_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$x(t)$" src="form_5.png" width="21" height="14"/></picture>, <picture><source srcset="form_6_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\dot{x}(t)$" src="form_6.png" width="21" height="14"/></picture> (optional), and <picture><source srcset="form_7_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\ddot{x}(t)$" src="form_7.png" width="21" height="14"/></picture> (optional)</li>
<li>The metastate - timestep, time, order, error, etc.</li>
<li>The StepperState - any data needed by the stepper</li>
<li>The PhysicsState - any application-specific data</li>
</ul>
<p><b>For additional details about the <a class="el" href="classTempus_1_1SolutionState.html" title="Solution state for integrators and steppers.">Tempus::SolutionState</a>, please see <a class="el" href="classTempus_1_1SolutionState.html#SolutionState_Description">SolutionState Description</a>!</b></p>
<p>For this example, we will only utilize and demonstrate the state and the metastate (<a class="el" href="classTempus_1_1SolutionStateMetaData.html" title="Solution state meta data.">Tempus::SolutionStateMetaData</a>).</p>
<h2><a class="anchor" id="changesToUseSolutionState"></a>
Changes to Use SolutionState</h2>
<p>In the following table are code snippets of the changes from the <a class="el" href="02__Use__ModelEvaluator_8cpp.html">02_Use_ModelEvaluator.cpp</a> to <a class="el" href="03__Intro__SolutionState_8cpp.html">03_Intro_SolutionState.cpp</a>. This is similar taking a difference between them for the <a class="el" href="03__Intro__SolutionState_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97" title="Description:">main()</a> function.</p>
<table class="doxtable">
<tr>
<th>Comments </th><th>"Use ModelEvaluator" Code Snippet </th><th>"Intro SolutionState" Code Snippet </th></tr>
<tr valign="top">
<td><p class="starttd"><b>Initial the SolutionState.</b> Create a SolutionState object with the initial-condition solution, <picture><source srcset="form_1_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$x$" src="form_1.png" width="8" height="6"/></picture>, from the ModelEvaluator, using the one of the non-member constructors. These non-member constructors set the remaining member data to default values (see <a class="el" href="namespaceTempus.html#a3320bdcae13842e7b5d34484d330ad79" title="Nonmember constructor from non-const solution vectors, x.">Tempus::createSolutionStateX</a>). Member data can also be set through the basic set functions, e.g., setIndex(0).</p>
<p class="endtd"><b>Note:</b> we did not include its time derivative, <picture><source srcset="form_2_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\dot{x}$" src="form_2.png" width="8" height="9"/></picture>, as part of the SolutionState because it is not needed for output or diagnostics. However we still require memory for it in the Forward Euler timestepping. Foreshadowing: the time derivative can be handled and maintained by all the time steppers internally. </p>
</td><td><div class="fragment"><div class="line"><span class="comment">// Get initial conditions from ModelEvaluator::getNominalValues.</span></div>
<div class="line"><span class="keywordtype">int</span> n = 0;</div>
<div class="line"><span class="keywordtype">double</span> time = 0.0;</div>
<div class="line">RCP&lt;Thyra::VectorBase&lt;double&gt; &gt; x_n    =</div>
<div class="line">  model-&gt;getNominalValues().get_x()-&gt;clone_v();</div>
<div class="line">RCP&lt;Thyra::VectorBase&lt;double&gt; &gt; xDot_n =</div>
<div class="line">  model-&gt;getNominalValues().get_x_dot()-&gt;clone_v();</div>
</div><!-- fragment --> </td><td><div class="fragment"><div class="line"><span class="comment">// Setup initial condition SolutionState --------------------</span></div>
<div class="line"><span class="keyword">auto</span> solState = <a class="code hl_function" href="namespaceTempus.html#a3320bdcae13842e7b5d34484d330ad79">Tempus::createSolutionStateX</a>(</div>
<div class="line">                  model-&gt;getNominalValues().get_x()-&gt;clone_v());</div>
<div class="line">solState-&gt;setIndex   (0);</div>
<div class="line">solState-&gt;setTime    (0.0);</div>
<div class="line">solState-&gt;setTimeStep(0.0);  <span class="comment">// By convention, the IC has dt=0.</span></div>
<div class="line">solState-&gt;setSolutionStatus(<a class="code hl_enumvalue" href="namespaceTempus.html#a24f0b0a527fc0ff0f86f64b5cff4532bae16fd3d6bcfba25f965511bdaf4594e0">Tempus::Status::PASSED</a>);  <span class="comment">// ICs are considered passed.</span></div>
<div class="line">RCP&lt;Thyra::VectorBase&lt;double&gt; &gt; xDot_n =</div>
<div class="line">  model-&gt;getNominalValues().get_x_dot()-&gt;clone_v();</div>
<div class="ttc" id="anamespaceTempus_html_a24f0b0a527fc0ff0f86f64b5cff4532bae16fd3d6bcfba25f965511bdaf4594e0"><div class="ttname"><a href="namespaceTempus.html#a24f0b0a527fc0ff0f86f64b5cff4532bae16fd3d6bcfba25f965511bdaf4594e0">Tempus::PASSED</a></div><div class="ttdeci">@ PASSED</div><div class="ttdef"><b>Definition</b> <a href="Tempus__Types_8hpp_source.html#l00018">Tempus_Types.hpp:18</a></div></div>
<div class="ttc" id="anamespaceTempus_html_a3320bdcae13842e7b5d34484d330ad79"><div class="ttname"><a href="namespaceTempus.html#a3320bdcae13842e7b5d34484d330ad79">Tempus::createSolutionStateX</a></div><div class="ttdeci">Teuchos::RCP&lt; SolutionState&lt; Scalar &gt; &gt; createSolutionStateX(const Teuchos::RCP&lt; Thyra::VectorBase&lt; Scalar &gt; &gt; &amp;x, const Teuchos::RCP&lt; Thyra::VectorBase&lt; Scalar &gt; &gt; &amp;xdot=Teuchos::null, const Teuchos::RCP&lt; Thyra::VectorBase&lt; Scalar &gt; &gt; &amp;xdotdot=Teuchos::null)</div><div class="ttdoc">Nonmember constructor from non-const solution vectors, x.</div><div class="ttdef"><b>Definition</b> <a href="Tempus__SolutionState__impl_8hpp_source.html#l00349">Tempus_SolutionState_impl.hpp:349</a></div></div>
</div><!-- fragment --> </td></tr>
<tr valign="top">
<td><b>Access member data of the SolutionState.</b> All the information about the solution and state are within the SolutionState object, and can be accessed through get functions, e.g., the index, time, solution, and solution status. </td><td><div class="fragment"><div class="line">cout &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; time &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; get_ele(*(x_n), 0)</div>
<div class="line">                          &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; get_ele(*(x_n), 1) &lt;&lt; endl;</div>
<div class="line"><span class="keywordflow">while</span> (passed &amp;&amp; time &lt; finalTime &amp;&amp; n &lt; nTimeSteps) {</div>
</div><!-- fragment --> </td><td><div class="fragment"><div class="line">cout &lt;&lt; solState-&gt;getIndex() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; solState-&gt;getTime()</div>
<div class="line">     &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; get_ele(*(solState-&gt;getX()), 0)</div>
<div class="line">     &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; get_ele(*(solState-&gt;getX()), 1) &lt;&lt; endl;</div>
<div class="line"><span class="keywordflow">while</span> (solState-&gt;getSolutionStatus() == <a class="code hl_enumvalue" href="namespaceTempus.html#a24f0b0a527fc0ff0f86f64b5cff4532bae16fd3d6bcfba25f965511bdaf4594e0">Tempus::Status::PASSED</a> &amp;&amp;</div>
<div class="line">       solState-&gt;getTime() &lt; finalTime &amp;&amp;</div>
<div class="line">       solState-&gt;getIndex() &lt; nTimeSteps) {</div>
</div><!-- fragment --> </td></tr>
<tr valign="top">
<td><b>Setup the next timestep.</b> To initialize the next time step, we set some Referenced Counted Pointers (RCPs), and create a scratch vector. Additionally, we set the index, time and timestep for the next ("working") time step solution. Although, not evident at this point, we will use the label "working" to help manage solutions that have not met the "passing" criteria, and we can try again with new settings, e.g., timestep size. </td><td><div class="fragment"><div class="line"><span class="comment">// Initialize next time step</span></div>
<div class="line">RCP&lt;Thyra::VectorBase&lt;double&gt; &gt; x_np1 = x_n-&gt;clone_v(); <span class="comment">// at time index n+1</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the timestep and time.</span></div>
<div class="line"><span class="keywordtype">double</span> dt = constDT;</div>
<div class="line">time = (n+1)*dt;</div>
</div><!-- fragment --> </td><td><div class="fragment"><div class="line"><span class="comment">// Initialize next time step</span></div>
<div class="line">RCP&lt;Thyra::VectorBase&lt;double&gt; &gt; x_n    = solState-&gt;getX();</div>
<div class="line">RCP&lt;Thyra::VectorBase&lt;double&gt; &gt; x_np1  = solState-&gt;getX()-&gt;clone_v(); <span class="comment">// at time index n+1</span></div>
<div class="line">solState-&gt;setSolutionStatus(<a class="code hl_enumvalue" href="namespaceTempus.html#a24f0b0a527fc0ff0f86f64b5cff4532ba3cf4240b78211ea422d238fd1cbc2bd4">Tempus::Status::WORKING</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the timestep and time for the working solution i.e., n+1.</span></div>
<div class="line"><span class="keywordtype">int</span> index = solState-&gt;getIndex()+1;</div>
<div class="line"><span class="keywordtype">double</span> dt = constDT;</div>
<div class="line"><span class="keywordtype">double</span> time = index*dt;</div>
<div class="ttc" id="anamespaceTempus_html_a24f0b0a527fc0ff0f86f64b5cff4532ba3cf4240b78211ea422d238fd1cbc2bd4"><div class="ttname"><a href="namespaceTempus.html#a24f0b0a527fc0ff0f86f64b5cff4532ba3cf4240b78211ea422d238fd1cbc2bd4">Tempus::WORKING</a></div><div class="ttdeci">@ WORKING</div><div class="ttdef"><b>Definition</b> <a href="Tempus__Types_8hpp_source.html#l00020">Tempus_Types.hpp:20</a></div></div>
</div><!-- fragment --> </td></tr>
<tr valign="top">
<td><b>Set status of SolutionState.</b> Need to set SolutionState status to PASSED or FAILED, increment the index and time, and set the timestep. </td><td><div class="fragment"><div class="line"><span class="comment">// Test if solution has passed.</span></div>
<div class="line"><span class="keywordflow">if</span> ( std::isnan(Thyra::norm(*x_np1)) ) {</div>
<div class="line">  passed = <span class="keyword">false</span>;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  <span class="comment">// Promote to next step (n &lt;- n+1).</span></div>
<div class="line">  Thyra::V_V(x_n.ptr(), *x_np1);</div>
<div class="line">  n++;</div>
<div class="line">}</div>
</div><!-- fragment --> </td><td><div class="fragment"><div class="line"><span class="comment">// Test if solution has passed.</span></div>
<div class="line"><span class="keywordflow">if</span> ( std::isnan(Thyra::norm(*x_np1)) ) {</div>
<div class="line">  solState-&gt;setSolutionStatus(<a class="code hl_enumvalue" href="namespaceTempus.html#a24f0b0a527fc0ff0f86f64b5cff4532baf898b16214feccb468bff5e226e602e1">Tempus::Status::FAILED</a>);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  <span class="comment">// Promote to next step (n &lt;- n+1).</span></div>
<div class="line">  Thyra::V_V(x_n.ptr(), *x_np1);</div>
<div class="line">  solState-&gt;setIndex   (index);</div>
<div class="line">  solState-&gt;setTime    (time);</div>
<div class="line">  solState-&gt;setTimeStep(constDT);</div>
<div class="line">  solState-&gt;setSolutionStatus(<a class="code hl_enumvalue" href="namespaceTempus.html#a24f0b0a527fc0ff0f86f64b5cff4532bae16fd3d6bcfba25f965511bdaf4594e0">Tempus::Status::PASSED</a>);</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceTempus_html_a24f0b0a527fc0ff0f86f64b5cff4532baf898b16214feccb468bff5e226e602e1"><div class="ttname"><a href="namespaceTempus.html#a24f0b0a527fc0ff0f86f64b5cff4532baf898b16214feccb468bff5e226e602e1">Tempus::FAILED</a></div><div class="ttdeci">@ FAILED</div><div class="ttdef"><b>Definition</b> <a href="Tempus__Types_8hpp_source.html#l00019">Tempus_Types.hpp:19</a></div></div>
</div><!-- fragment --> </td></tr>
<tr valign="top">
<td><b>Access the SolutionState.</b> Need to access the SolutionState for the solution index. Note the RCP x_n still has access to the solution vector. </td><td><div class="fragment"><div class="line"><span class="comment">// Output</span></div>
<div class="line"><span class="keywordflow">if</span> ( n%100 == 0 )</div>
<div class="line">  cout &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; time &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; get_ele(*(x_n), 0)</div>
<div class="line">                            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; get_ele(*(x_n), 1) &lt;&lt; endl;</div>
</div><!-- fragment --> </td><td><div class="fragment"><div class="line"><span class="comment">// Output</span></div>
<div class="line"><span class="keywordflow">if</span> ( solState-&gt;getIndex()%100 == 0 )</div>
<div class="line">  cout &lt;&lt; solState-&gt;getIndex() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; time</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; get_ele(*(x_n), 0)</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; get_ele(*(x_n), 1) &lt;&lt; endl;</div>
</div><!-- fragment --> </td></tr>
</table>
<p>The remainder of <a class="el" href="03__Intro__SolutionState_8cpp.html">03_Intro_SolutionState.cpp</a> is regression testing, etc.</p>
<h2><a class="anchor" id="example-03_Next"></a>
Links</h2>
<ul>
<li>Back to: <a class="el" href="index.html#tutorials">Tutorials</a></li>
<li>Previous: <a class="el" href="02__Use__ModelEvaluator_8cpp.html#example-02">Example 2: Use ModelEvaluator</a></li>
<li>Next: Adding SolutionHistory </li>
</ul>

<p class="definition">Definition at line <a class="el" href="03__Intro__SolutionState_8cpp_source.html#l00213">213</a> of file <a class="el" href="03__Intro__SolutionState_8cpp_source.html">03_Intro_SolutionState.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
