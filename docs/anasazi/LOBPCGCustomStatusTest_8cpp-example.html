<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Anasazi: LOBPCGCustomStatusTest.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Anasazi<span id="projectnumber">&#160;Version of the Day</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">LOBPCGCustomStatusTest.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>Use LOBPCG with Tpetra, with custom StatusTest.</p>
<p>Use LOBPCG with Tpetra, with custom StatusTest.This example shows how to define a custom StatusTest so that <a class="el" href="namespaceAnasazi.html" title="Namespace Anasazi contains the classes, structs, enums and utilities used by the Anasazi package.">Anasazi</a>'s solver LOBPCG converges correctly with spectrum folding. Without a custom status test, <a class="el" href="namespaceAnasazi.html" title="Namespace Anasazi contains the classes, structs, enums and utilities used by the Anasazi package.">Anasazi</a> would compute the residual as <picture><source srcset="form_96_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ R = A^2 X - X \Sigma^2$" src="form_96.png" width="93" height="11"/></picture>. The custom status test makes <a class="el" href="namespaceAnasazi.html" title="Namespace Anasazi contains the classes, structs, enums and utilities used by the Anasazi package.">Anasazi</a> use the residual <picture><source srcset="form_97_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ R = A X - X \Sigma$" src="form_97.png" width="83" height="10"/></picture> instead.</p>
<div class="fragment"><div class="line"><span class="comment">// @HEADER</span></div>
<div class="line"><span class="comment">// *****************************************************************************</span></div>
<div class="line"><span class="comment">//                 Anasazi: Block Eigensolvers Package</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Copyright 2004 NTESS and the Anasazi contributors.</span></div>
<div class="line"><span class="comment">// SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment">// *****************************************************************************</span></div>
<div class="line"><span class="comment">// @HEADER</span></div>
<div class="line"><span class="comment">// This example shows how to define a custom operator and status test for Anasazi</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="AnasaziBasicEigenproblem_8hpp.html">AnasaziBasicEigenproblem.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="AnasaziTpetraAdapter_8hpp.html">AnasaziTpetraAdapter.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="AnasaziStatusTestDecl_8hpp.html">AnasaziStatusTestDecl.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="AnasaziLOBPCGSolMgr_8hpp.html">AnasaziLOBPCGSolMgr.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="AnasaziTypes_8hpp.html">AnasaziTypes.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;Teuchos_GlobalMPISession.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Tpetra_Core.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;MatrixMarket_Tpetra.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// These tell the compiler which namespace contains RCP, cout, etc</span></div>
<div class="line"><span class="keyword">using </span>Teuchos::RCP;</div>
<div class="line"><span class="keyword">using </span>Teuchos::rcp;</div>
<div class="line"><span class="keyword">using </span>Teuchos::ArrayView;</div>
<div class="line"><span class="keyword">using </span>std::cout;</div>
<div class="line"><span class="keyword">using </span>std::endl;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// These define convenient aliases</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span>                                   Scalar;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> Tpetra::MultiVector&lt;Scalar&gt;              TMV;</div>
<div class="line"><span class="keyword">typedef</span> Tpetra::Vector&lt;Scalar&gt;                   Vector;</div>
<div class="line"><span class="keyword">typedef</span> Tpetra::Operator&lt;Scalar&gt;                 TOP;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>{ <span class="comment">// (anonymous)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// This class defines an operator A^2 for spectrum folding.  We don&#39;t</span></div>
<div class="line"><span class="comment">// explicitly form the matrix A^2; we just implement its action on a</span></div>
<div class="line"><span class="comment">// vector.  We can do this because Anasazi is templated on operators</span></div>
<div class="line"><span class="comment">// rather than matrices.</span></div>
<div class="line"><span class="keyword">class </span>FoldOp : <span class="keyword">public</span> TOP {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">typedef</span> Tpetra::Map&lt;&gt; map_type;</div>
<div class="line"> </div>
<div class="line">  FoldOp (<span class="keyword">const</span> RCP&lt;const TOP&gt; A) { A_ = A; };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> SetUseTranspose (<span class="keywordtype">bool</span> UseTranspose) { <span class="keywordflow">return</span> -1; };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  apply (<span class="keyword">const</span> TMV&amp; X, TMV&amp; Y, Teuchos::ETransp mode = Teuchos::NO_TRANS,</div>
<div class="line">         Scalar alpha = Teuchos::ScalarTraits&lt;Scalar&gt;::one (),</div>
<div class="line">         Scalar beta = Teuchos::ScalarTraits&lt;Scalar&gt;::zero ()) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  RCP&lt;const map_type&gt; getDomainMap ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> A_-&gt;getDomainMap (); };</div>
<div class="line">  RCP&lt;const map_type&gt; getRangeMap ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> A_-&gt;getRangeMap (); };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  RCP&lt;const TOP&gt; A_;</div>
<div class="line">}; <span class="comment">// end of class</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">FoldOp::apply (<span class="keyword">const</span> TMV &amp;X, TMV &amp;Y, Teuchos::ETransp mode,</div>
<div class="line">               Scalar alpha, Scalar beta)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  TMV Y1 (X.getMap (), X.getNumVectors (), <span class="keyword">false</span>);</div>
<div class="line">  A_-&gt;apply (X, Y1, mode, alpha, beta);</div>
<div class="line">  A_-&gt;apply (Y1, Y, mode, alpha, beta);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a custom status test for spectrum folding.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Since our operator is defined as A^2, the Anasazi eigensolvers will</span></div>
<div class="line"><span class="comment">// compute the residual as R = A^2 X - X \Sigma^2.  We want to monitor</span></div>
<div class="line"><span class="comment">// the residual R = A X - X \Sigma instead.</span></div>
<div class="line"><span class="keyword">class </span>StatusTestFolding : <span class="keyword">public</span> <a id="_a0" name="_a0"></a><a class="code hl_class" href="classAnasazi_1_1StatusTest.html">Anasazi::StatusTest</a>&lt;Scalar,TMV,TOP&gt; {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Constructor</span></div>
<div class="line">  StatusTestFolding (Scalar tol, <span class="keywordtype">int</span> quorum = -1,</div>
<div class="line">                     <span class="keywordtype">bool</span> scaled = <span class="keyword">true</span>,</div>
<div class="line">                     <span class="keywordtype">bool</span> throwExceptionOnNan = <span class="keyword">true</span>,</div>
<div class="line">                     <span class="keyword">const</span> RCP&lt;const TOP&gt;&amp; A = Teuchos::null);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Destructor</span></div>
<div class="line">  <span class="keyword">virtual</span> ~StatusTestFolding() {};</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Check whether the test passed or failed</span></div>
<div class="line">  <a class="code hl_enumeration" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2">Anasazi::TestStatus</a> <a id="a1" name="a1"></a><a class="code hl_function" href="classAnasazi_1_1StatusTest.html#a5a0243628e67e1306ae6a73b1a7e726f">checkStatus</a> (<a id="_a2" name="_a2"></a><a class="code hl_class" href="classAnasazi_1_1Operator.html">Anasazi::Eigensolver&lt;Scalar,TMV,TOP&gt;</a>* solver);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Return the result of the most recent checkStatus call</span></div>
<div class="line">  <a class="code hl_enumeration" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2">Anasazi::TestStatus</a> <a id="a3" name="a3"></a><a class="code hl_function" href="classAnasazi_1_1StatusTest.html#aff6f2ae02fb12ba1847fe4716d7b1e7d">getStatus</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> state_; }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Get the indices for the vectors that passed the test</span></div>
<div class="line">  std::vector&lt;int&gt; <a id="a4" name="a4"></a><a class="code hl_function" href="classAnasazi_1_1StatusTest.html#a1389be047d9edc9e5ae713687ff2e9f2">whichVecs</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ind_; }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Get the number of vectors that passed the test</span></div>
<div class="line">  <span class="keywordtype">int</span> <a id="a5" name="a5"></a><a class="code hl_function" href="classAnasazi_1_1StatusTest.html#a218e61618f32f0990e63c1ceec6f1c6d">howMany</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ind_.size (); }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Informs the status test that it should reset its internal configuration to the uninitialized state</span></div>
<div class="line">  <span class="keywordtype">void</span> <a id="a6" name="a6"></a><a class="code hl_function" href="classAnasazi_1_1StatusTest.html#a38c280f12ee9fd205b3a435b20043624">reset</a> () {</div>
<div class="line">    ind_.resize (0);</div>
<div class="line">    state_ = <a id="a7" name="a7"></a><a class="code hl_enumvalue" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a0e0d7b1d4280c818d697128327e4f534">Anasazi::Undefined</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Clears the results of the last status test</span></div>
<div class="line">  <span class="keywordtype">void</span> <a id="a8" name="a8"></a><a class="code hl_function" href="classAnasazi_1_1StatusTest.html#afd9c763c806cafcace84a9a7164c3108">clearStatus</a> () { <a class="code hl_function" href="classAnasazi_1_1StatusTest.html#a38c280f12ee9fd205b3a435b20043624">reset</a> (); };</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Output formatted description of stopping test to output stream</span></div>
<div class="line">  std::ostream&amp; <a id="a9" name="a9"></a><a class="code hl_function" href="classAnasazi_1_1StatusTest.html#a8f924c55c46d0ed0896b7b1c8f1df8a7">print</a> (std::ostream &amp;os, <span class="keywordtype">int</span> indent=0) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <a class="code hl_enumeration" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2">Anasazi::TestStatus</a> state_;</div>
<div class="line">  Scalar tol_;</div>
<div class="line">  std::vector&lt;int&gt; ind_;</div>
<div class="line">  <span class="keywordtype">int</span> quorum_;</div>
<div class="line">  <span class="keywordtype">bool</span> scaled_;</div>
<div class="line">  <span class="comment">// bool throwExceptionOnNaN_; (unused)</span></div>
<div class="line">  RCP&lt;const TOP&gt; A_;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> Scalar ONE;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Constructor for our custom status test</span></div>
<div class="line">StatusTestFolding::</div>
<div class="line">StatusTestFolding (Scalar tol, <span class="keywordtype">int</span> quorum, <span class="keywordtype">bool</span> scaled,</div>
<div class="line">                   <span class="keywordtype">bool</span> <span class="comment">/* throwExceptionOnNaN (unused) */</span>,</div>
<div class="line">                   <span class="keyword">const</span> RCP&lt;const TOP&gt;&amp; A)</div>
<div class="line">  : state_ (<a class="code hl_enumvalue" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a0e0d7b1d4280c818d697128327e4f534">Anasazi::Undefined</a>),</div>
<div class="line">    tol_ (tol),</div>
<div class="line">    quorum_ (quorum),</div>
<div class="line">    scaled_ (scaled),</div>
<div class="line">    <span class="comment">/* throwExceptionOnNaN_ (throwExceptionOnNaN), (unused) */</span></div>
<div class="line">    A_ (A),</div>
<div class="line">    ONE (Teuchos::ScalarTraits&lt;Scalar&gt;::one ())</div>
<div class="line">{}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check whether the test passed or failed</span></div>
<div class="line"><a class="code hl_enumeration" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2">Anasazi::TestStatus</a></div>
<div class="line">StatusTestFolding::checkStatus (<a class="code hl_class" href="classAnasazi_1_1Operator.html">Anasazi::Eigensolver&lt;Scalar,TMV,TOP&gt;</a>* solver)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">typedef</span> <a class="code hl_class" href="classAnasazi_1_1Operator.html">Anasazi::MultiVecTraits&lt;Scalar, TMV&gt;</a> TMVT;</div>
<div class="line"> </div>
<div class="line">  RCP&lt;const TMV&gt; X = solver-&gt;getRitzVectors ();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> numev = X-&gt;getNumVectors ();</div>
<div class="line">  std::vector&lt;Scalar&gt; res (numev);</div>
<div class="line">  TMV AX (X-&gt;getMap (), numev, <span class="keyword">false</span>);</div>
<div class="line">  Teuchos::SerialDenseMatrix&lt;int, Scalar&gt; T (numev, numev);</div>
<div class="line"> </div>
<div class="line">  A_-&gt;apply (*X, AX);</div>
<div class="line">  TMVT::MvTransMv (1.0, AX, *X, T);</div>
<div class="line">  TMVT::MvTimesMatAddMv (-1.0, *X, T, 1.0, AX);</div>
<div class="line">  TMVT::MvNorm (AX, res);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// if appropriate, scale the norms by the magnitude of the eigenvalue estimate</span></div>
<div class="line">  <span class="keywordflow">if</span> (scaled_) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numev; ++i) {</div>
<div class="line">      res[i] /= std::abs (T(i,i));</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// test the norms</span></div>
<div class="line">  ind_.resize (0);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numev; ++i) {</div>
<div class="line">    <span class="keywordflow">if</span> (res[i] &lt; tol_) {</div>
<div class="line">      ind_.push_back (i);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> have = ind_.size ();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> need = (quorum_ == -1) ? numev : quorum_;</div>
<div class="line">  state_ = (have &gt;= need) ? <a id="a10" name="a10"></a><a class="code hl_enumvalue" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a37e4db41c154382c42a280dfb2eebad8">Anasazi::Passed</a> : <a id="a11" name="a11"></a><a class="code hl_enumvalue" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a9b73a6d49abb67b1edcd2c524b9332e0">Anasazi::Failed</a>;</div>
<div class="line">  <span class="keywordflow">return</span> state_;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Output formatted description of stopping test to output stream</span></div>
<div class="line">std::ostream&amp;</div>
<div class="line">StatusTestFolding::print (std::ostream&amp; os, <span class="keywordtype">int</span> indent)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::string ind (indent, <span class="charliteral">&#39; &#39;</span>);</div>
<div class="line">  os &lt;&lt; ind &lt;&lt; <span class="stringliteral">&quot;- StatusTestFolding: &quot;</span>;</div>
<div class="line">  <span class="keywordflow">switch</span> (state_) {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a37e4db41c154382c42a280dfb2eebad8">Anasazi::Passed</a>:</div>
<div class="line">    os &lt;&lt; <span class="stringliteral">&quot;Passed\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a9b73a6d49abb67b1edcd2c524b9332e0">Anasazi::Failed</a>:</div>
<div class="line">    os &lt;&lt; <span class="stringliteral">&quot;Failed\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a0e0d7b1d4280c818d697128327e4f534">Anasazi::Undefined</a>:</div>
<div class="line">    os &lt;&lt; <span class="stringliteral">&quot;Undefined\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  os &lt;&lt; ind &lt;&lt; <span class="stringliteral">&quot;  (Tolerance, WhichNorm,Scaled,Quorum): &quot;</span></div>
<div class="line">     &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; tol_</div>
<div class="line">     &lt;&lt; <span class="stringliteral">&quot;,RES_2NORM&quot;</span></div>
<div class="line">     &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; (scaled_ ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>)</div>
<div class="line">     &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; quorum_</div>
<div class="line">     &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (state_ != <a class="code hl_enumvalue" href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a0e0d7b1d4280c818d697128327e4f534">Anasazi::Undefined</a>) {</div>
<div class="line">    os &lt;&lt; ind &lt;&lt; <span class="stringliteral">&quot;  Which vectors: &quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (ind_.size () &gt; 0) {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; ind_.size (); ++i) {</div>
<div class="line">        os &lt;&lt; ind_[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">      }</div>
<div class="line">      os &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      os &lt;&lt; <span class="stringliteral">&quot;[empty]\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> os;</div>
<div class="line">}</div>
<div class="line">} <span class="comment">// namespace (anonymous)</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">typedef</span> <a class="code hl_class" href="classAnasazi_1_1Operator.html">Anasazi::BasicEigenproblem&lt;Scalar,TMV,TOP&gt;</a> Problem;</div>
<div class="line">  <span class="keyword">typedef</span> <a class="code hl_class" href="classAnasazi_1_1Operator.html">Anasazi::MultiVecTraits&lt;Scalar, TMV&gt;</a> TMVT;</div>
<div class="line">  <span class="keyword">typedef</span> <a class="code hl_class" href="classAnasazi_1_1Operator.html">Anasazi::OperatorTraits&lt;Scalar, TMV, TOP&gt;</a> TOPT;</div>
<div class="line">  <span class="keyword">typedef</span> Tpetra::CrsMatrix&lt;&gt; CrsMatrix;</div>
<div class="line">  <span class="keyword">typedef</span> Tpetra::MatrixMarket::Reader&lt;CrsMatrix&gt;  Reader;</div>
<div class="line"> </div>
<div class="line">  Tpetra::ScopeGuard tpetraScope (&amp;argc, &amp;argv);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Get the default communicator</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  RCP&lt;const Teuchos::Comm&lt;int&gt; &gt; comm = Tpetra::getDefaultComm ();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> myRank = comm-&gt;getRank();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Read the command line arguments</span></div>
<div class="line">  std::string fileA (<span class="stringliteral">&quot;/u/slotnick_s2/aklinvex/matrices/anderson4.mtx&quot;</span>);</div>
<div class="line">  Teuchos::CommandLineProcessor cmdp (<span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line">  cmdp.setOption (<span class="stringliteral">&quot;fileA&quot;</span>, &amp;fileA, <span class="stringliteral">&quot;Filename for the Matrix-Market stiffness matrix.&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (cmdp.parse (argc,argv) != Teuchos::CommandLineProcessor::PARSE_SUCCESSFUL) {</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Get the matrix</span></div>
<div class="line">  RCP&lt;const CrsMatrix&gt; A = Reader::readSparseFile (fileA, comm);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create the folded operator, K = A^2</span></div>
<div class="line">  RCP&lt;FoldOp&gt; K = rcp (<span class="keyword">new</span> FoldOp (A));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set parameters for solver</span></div>
<div class="line">  <span class="keywordtype">int</span> blockSize = 4;</div>
<div class="line">  <span class="keywordtype">double</span> tol = 1e-5;</div>
<div class="line">  <span class="keywordtype">bool</span> scaled = <span class="keyword">true</span>;</div>
<div class="line">  <span class="keywordtype">int</span> nev = 4;</div>
<div class="line"> </div>
<div class="line">  Teuchos::ParameterList MyPL;</div>
<div class="line">  MyPL.set (<span class="stringliteral">&quot;Which&quot;</span>, <span class="stringliteral">&quot;SR&quot;</span>);</div>
<div class="line">  MyPL.set (<span class="stringliteral">&quot;Maximum Restarts&quot;</span>, 10000);</div>
<div class="line">  MyPL.set (<span class="stringliteral">&quot;Maximum Iterations&quot;</span>, 1000000);</div>
<div class="line">  MyPL.set (<span class="stringliteral">&quot;Block Size&quot;</span>, blockSize);</div>
<div class="line">  MyPL.set (<span class="stringliteral">&quot;Convergence Tolerance&quot;</span>, tol );   <span class="comment">// How small do the residuals have to be</span></div>
<div class="line">  MyPL.set (<span class="stringliteral">&quot;Relative Convergence Tolerance&quot;</span>, scaled);</div>
<div class="line">  MyPL.set (<span class="stringliteral">&quot;Relative Locking Tolerance&quot;</span>, scaled);</div>
<div class="line">  MyPL.set (<span class="stringliteral">&quot;Verbosity&quot;</span>, <a id="a12" name="a12"></a><a class="code hl_enumvalue" href="namespaceAnasazi.html#ac1cd930ca09987d38fe97bbb8c65507daa04bd73cdc419c447db8771af5d18f83">Anasazi::TimingDetails</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a MultiVector for an initial subspace to start the solver.</span></div>
<div class="line">  RCP&lt;TMV&gt; ivec = rcp (<span class="keyword">new</span> TMV (A-&gt;getRowMap (), blockSize));</div>
<div class="line">  TMVT::MvRandom (*ivec);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create the eigenproblem</span></div>
<div class="line">  RCP&lt;Problem&gt; MyProblem = rcp (<span class="keyword">new</span> Problem (K, ivec));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Inform the eigenproblem that the matrix pencil (K,M) is symmetric</span></div>
<div class="line">  MyProblem-&gt;setHermitian (<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Set the number of eigenvalues requested</span></div>
<div class="line">  MyProblem-&gt;setNEV (nev);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Tell the problem that you are finished passing it information</span></div>
<div class="line">  MyProblem-&gt;setProblem ();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create the eigensolver and give it your problem and parameters.</span></div>
<div class="line">  <a class="code hl_class" href="classAnasazi_1_1Operator.html">Anasazi::LOBPCGSolMgr&lt;Scalar,TMV,TOP&gt;</a> solver (MyProblem, MyPL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Give the eigensolver a status test consistent with the spectral transformation.</span></div>
<div class="line">  RCP&lt;StatusTestFolding&gt; convTest =</div>
<div class="line">    rcp (<span class="keyword">new</span> StatusTestFolding (tol, nev, scaled, <span class="keyword">true</span>, A));</div>
<div class="line">  RCP&lt;StatusTestFolding&gt; lockTest =</div>
<div class="line">    rcp (<span class="keyword">new</span> StatusTestFolding (tol/10., 1, scaled, <span class="keyword">true</span>, A));</div>
<div class="line">  solver.setGlobalStatusTest (convTest);</div>
<div class="line">  solver.setLockingStatusTest (lockTest);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Tell the solver to solve the eigenproblem.</span></div>
<div class="line">  <a class="code hl_enumeration" href="namespaceAnasazi.html#a823537bb3d658892d7388be67cf036a6">Anasazi::ReturnType</a> returnCode = solver.solve ();</div>
<div class="line">  <span class="keywordflow">if</span> (returnCode != <a id="a13" name="a13"></a><a class="code hl_enumvalue" href="namespaceAnasazi.html#a823537bb3d658892d7388be67cf036a6a43d6b459d6ecd3f2d638063a61c58880">Anasazi::Converged</a> &amp;&amp; myRank == 0) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;The solve did NOT converge.&quot;</span> &lt;&lt; endl;</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (myRank == 0) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;The solve converged.&quot;</span> &lt;&lt; endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Get the eigenvalues and eigenvectors from the eigenproblem</span></div>
<div class="line">  <a class="code hl_class" href="classAnasazi_1_1Operator.html">Anasazi::Eigensolution&lt;Scalar,TMV&gt;</a> sol = MyProblem-&gt;getSolution ();</div>
<div class="line">  std::vector&lt;Anasazi::Value&lt;Scalar&gt; &gt; evals = sol.Evals;</div>
<div class="line">  RCP&lt;TMV&gt; evecs = sol.Evecs;</div>
<div class="line">  <span class="keywordtype">int</span> numev = sol.numVecs;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Compute the residual, just as a precaution</span></div>
<div class="line">  <span class="keywordflow">if</span> (numev &gt; 0) {</div>
<div class="line">    std::vector&lt;Scalar&gt; normR (sol.numVecs);</div>
<div class="line"> </div>
<div class="line">    TMV Avec (A-&gt;getRowMap (), TMVT::GetNumberVecs (*evecs));</div>
<div class="line">    TOPT::Apply (*A, *evecs, Avec);</div>
<div class="line">    Teuchos::SerialDenseMatrix&lt;int,Scalar&gt; T (numev, numev);</div>
<div class="line">    TMVT::MvTransMv (1.0, Avec, *evecs, T);</div>
<div class="line"> </div>
<div class="line">    TMVT::MvTimesMatAddMv (-1.0, *evecs, T, 1.0, Avec);</div>
<div class="line">    TMVT::MvNorm (Avec, normR);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (myRank == 0) {</div>
<div class="line">      cout.setf(std::ios_base::right, std::ios_base::adjustfield);</div>
<div class="line">      cout&lt;&lt;<span class="stringliteral">&quot;Actual Eigenvalues: &quot;</span>&lt;&lt;std::endl;</div>
<div class="line">      cout&lt;&lt;<span class="stringliteral">&quot;------------------------------------------------------&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">      cout&lt;&lt;std::setw(16)&lt;&lt;<span class="stringliteral">&quot;Real Part&quot;</span></div>
<div class="line">        &lt;&lt;std::setw(16)&lt;&lt;<span class="stringliteral">&quot;Error&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">      cout&lt;&lt;<span class="stringliteral">&quot;------------------------------------------------------&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numev; i++) {</div>
<div class="line">        cout&lt;&lt;std::setw(16)&lt;&lt;T(i,i)</div>
<div class="line">          &lt;&lt;std::setw(16)&lt;&lt;normR[i]/std::abs(T(i,i))</div>
<div class="line">          &lt;&lt;std::endl;</div>
<div class="line">      }</div>
<div class="line">      cout&lt;&lt;<span class="stringliteral">&quot;------------------------------------------------------&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aAnasaziBasicEigenproblem_8hpp_html"><div class="ttname"><a href="AnasaziBasicEigenproblem_8hpp.html">AnasaziBasicEigenproblem.hpp</a></div><div class="ttdoc">Basic implementation of the Anasazi::Eigenproblem class.</div></div>
<div class="ttc" id="aAnasaziLOBPCGSolMgr_8hpp_html"><div class="ttname"><a href="AnasaziLOBPCGSolMgr_8hpp.html">AnasaziLOBPCGSolMgr.hpp</a></div><div class="ttdoc">The Anasazi::LOBPCGSolMgr provides a powerful solver manager for the LOBPCG eigensolver.</div></div>
<div class="ttc" id="aAnasaziStatusTestDecl_8hpp_html"><div class="ttname"><a href="AnasaziStatusTestDecl_8hpp.html">AnasaziStatusTestDecl.hpp</a></div><div class="ttdoc">Forward declaration of pure virtual base class Anasazi::StatusTest.</div></div>
<div class="ttc" id="aAnasaziTpetraAdapter_8hpp_html"><div class="ttname"><a href="AnasaziTpetraAdapter_8hpp.html">AnasaziTpetraAdapter.hpp</a></div><div class="ttdoc">Partial specialization of Anasazi::MultiVecTraits and Anasazi::OperatorTraits for Tpetra objects.</div></div>
<div class="ttc" id="aAnasaziTypes_8hpp_html"><div class="ttname"><a href="AnasaziTypes_8hpp.html">AnasaziTypes.hpp</a></div><div class="ttdoc">Types and exceptions used within Anasazi solvers and interfaces.</div></div>
<div class="ttc" id="aclassAnasazi_1_1Operator_html"><div class="ttname"><a href="classAnasazi_1_1Operator.html">Anasazi::Operator</a></div><div class="ttdoc">Anasazi's templated virtual class for constructing an operator that can interface with the OperatorTr...</div><div class="ttdef"><b>Definition</b> <a href="AnasaziOperator_8hpp_source.html#l00035">AnasaziOperator.hpp:35</a></div></div>
<div class="ttc" id="aclassAnasazi_1_1StatusTest_html"><div class="ttname"><a href="classAnasazi_1_1StatusTest.html">Anasazi::StatusTest</a></div><div class="ttdoc">Common interface of stopping criteria for Anasazi's solvers.</div><div class="ttdef"><b>Definition</b> <a href="AnasaziStatusTest_8hpp_source.html#l00043">AnasaziStatusTest.hpp:43</a></div></div>
<div class="ttc" id="aclassAnasazi_1_1StatusTest_html_a1389be047d9edc9e5ae713687ff2e9f2"><div class="ttname"><a href="classAnasazi_1_1StatusTest.html#a1389be047d9edc9e5ae713687ff2e9f2">Anasazi::StatusTest::whichVecs</a></div><div class="ttdeci">virtual std::vector&lt; int &gt; whichVecs() const =0</div><div class="ttdoc">Get the indices for the vectors that passed the test.</div></div>
<div class="ttc" id="aclassAnasazi_1_1StatusTest_html_a218e61618f32f0990e63c1ceec6f1c6d"><div class="ttname"><a href="classAnasazi_1_1StatusTest.html#a218e61618f32f0990e63c1ceec6f1c6d">Anasazi::StatusTest::howMany</a></div><div class="ttdeci">virtual int howMany() const =0</div><div class="ttdoc">Get the number of vectors that passed the test.</div></div>
<div class="ttc" id="aclassAnasazi_1_1StatusTest_html_a38c280f12ee9fd205b3a435b20043624"><div class="ttname"><a href="classAnasazi_1_1StatusTest.html#a38c280f12ee9fd205b3a435b20043624">Anasazi::StatusTest::reset</a></div><div class="ttdeci">virtual void reset()=0</div><div class="ttdoc">Informs the status test that it should reset its internal configuration to the uninitialized state.</div></div>
<div class="ttc" id="aclassAnasazi_1_1StatusTest_html_a5a0243628e67e1306ae6a73b1a7e726f"><div class="ttname"><a href="classAnasazi_1_1StatusTest.html#a5a0243628e67e1306ae6a73b1a7e726f">Anasazi::StatusTest::checkStatus</a></div><div class="ttdeci">virtual TestStatus checkStatus(Eigensolver&lt; ScalarType, MV, OP &gt; *solver)=0</div></div>
<div class="ttc" id="aclassAnasazi_1_1StatusTest_html_a8f924c55c46d0ed0896b7b1c8f1df8a7"><div class="ttname"><a href="classAnasazi_1_1StatusTest.html#a8f924c55c46d0ed0896b7b1c8f1df8a7">Anasazi::StatusTest::print</a></div><div class="ttdeci">virtual std::ostream &amp; print(std::ostream &amp;os, int indent=0) const =0</div><div class="ttdoc">Output formatted description of stopping test to output stream.</div></div>
<div class="ttc" id="aclassAnasazi_1_1StatusTest_html_afd9c763c806cafcace84a9a7164c3108"><div class="ttname"><a href="classAnasazi_1_1StatusTest.html#afd9c763c806cafcace84a9a7164c3108">Anasazi::StatusTest::clearStatus</a></div><div class="ttdeci">virtual void clearStatus()=0</div><div class="ttdoc">Clears the results of the last status test.</div></div>
<div class="ttc" id="aclassAnasazi_1_1StatusTest_html_aff6f2ae02fb12ba1847fe4716d7b1e7d"><div class="ttname"><a href="classAnasazi_1_1StatusTest.html#aff6f2ae02fb12ba1847fe4716d7b1e7d">Anasazi::StatusTest::getStatus</a></div><div class="ttdeci">virtual TestStatus getStatus() const =0</div><div class="ttdoc">Return the result of the most recent checkStatus call, or undefined if it has not been run.</div></div>
<div class="ttc" id="anamespaceAnasazi_html_a823537bb3d658892d7388be67cf036a6"><div class="ttname"><a href="namespaceAnasazi.html#a823537bb3d658892d7388be67cf036a6">Anasazi::ReturnType</a></div><div class="ttdeci">ReturnType</div><div class="ttdoc">Enumerated type used to pass back information from a solver manager.</div><div class="ttdef"><b>Definition</b> <a href="AnasaziTypes_8hpp_source.html#l00088">AnasaziTypes.hpp:89</a></div></div>
<div class="ttc" id="anamespaceAnasazi_html_a823537bb3d658892d7388be67cf036a6a43d6b459d6ecd3f2d638063a61c58880"><div class="ttname"><a href="namespaceAnasazi.html#a823537bb3d658892d7388be67cf036a6a43d6b459d6ecd3f2d638063a61c58880">Anasazi::Converged</a></div><div class="ttdeci">@ Converged</div><div class="ttdef"><b>Definition</b> <a href="AnasaziTypes_8hpp_source.html#l00090">AnasaziTypes.hpp:90</a></div></div>
<div class="ttc" id="anamespaceAnasazi_html_ac1cd930ca09987d38fe97bbb8c65507daa04bd73cdc419c447db8771af5d18f83"><div class="ttname"><a href="namespaceAnasazi.html#ac1cd930ca09987d38fe97bbb8c65507daa04bd73cdc419c447db8771af5d18f83">Anasazi::TimingDetails</a></div><div class="ttdeci">@ TimingDetails</div><div class="ttdef"><b>Definition</b> <a href="AnasaziTypes_8hpp_source.html#l00136">AnasaziTypes.hpp:136</a></div></div>
<div class="ttc" id="anamespaceAnasazi_html_aecc89d0f13b3e478065ad8d8b53788c2"><div class="ttname"><a href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2">Anasazi::TestStatus</a></div><div class="ttdeci">TestStatus</div><div class="ttdoc">Enumerated type used to pass back information from a StatusTest.</div><div class="ttdef"><b>Definition</b> <a href="AnasaziTypes_8hpp_source.html#l00109">AnasaziTypes.hpp:110</a></div></div>
<div class="ttc" id="anamespaceAnasazi_html_aecc89d0f13b3e478065ad8d8b53788c2a0e0d7b1d4280c818d697128327e4f534"><div class="ttname"><a href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a0e0d7b1d4280c818d697128327e4f534">Anasazi::Undefined</a></div><div class="ttdeci">@ Undefined</div><div class="ttdef"><b>Definition</b> <a href="AnasaziTypes_8hpp_source.html#l00114">AnasaziTypes.hpp:113</a></div></div>
<div class="ttc" id="anamespaceAnasazi_html_aecc89d0f13b3e478065ad8d8b53788c2a37e4db41c154382c42a280dfb2eebad8"><div class="ttname"><a href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a37e4db41c154382c42a280dfb2eebad8">Anasazi::Passed</a></div><div class="ttdeci">@ Passed</div><div class="ttdef"><b>Definition</b> <a href="AnasaziTypes_8hpp_source.html#l00111">AnasaziTypes.hpp:111</a></div></div>
<div class="ttc" id="anamespaceAnasazi_html_aecc89d0f13b3e478065ad8d8b53788c2a9b73a6d49abb67b1edcd2c524b9332e0"><div class="ttname"><a href="namespaceAnasazi.html#aecc89d0f13b3e478065ad8d8b53788c2a9b73a6d49abb67b1edcd2c524b9332e0">Anasazi::Failed</a></div><div class="ttdeci">@ Failed</div><div class="ttdef"><b>Definition</b> <a href="AnasaziTypes_8hpp_source.html#l00112">AnasaziTypes.hpp:112</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
