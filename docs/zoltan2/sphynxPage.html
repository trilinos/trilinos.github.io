<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zoltan2: Graph partitioning with Sphynx</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Zoltan2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Graph partitioning with Sphynx</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sphynx_algorithm"></a>
Algorithm Overview</h1>
<p>Sphynx is a hybrid distributed- and shared-memory-enabled parallel graph partitioner, which is the first graph partitioning tool that works on GPUs on distributed-memory settings. It is based on spectral partitioning and computes log2(K) eigenvectors on the Laplacian matrix of the original graph using the LOBPCG algorithm (from the Anasazi package), where K denotes the desired number of parts. The eigevectors are computed all at once on the original graph, so Sphynx is not recursive unlike the traditional spectral partitioners. Sphynx then uses the entries of the log2(K) eigenvectors as coordinates of the vertices and calls the multi-jagged (MJ) algorithm (from the <a class="el" href="namespaceZoltan2.html" title="Created by mbenlioglu on Aug 31, 2020.">Zoltan2</a> package) to partition those coordinates.</p>
<p>The LOBPCG algorithm allows Sphynx to use any preconditioner. Currently, it supports three preconditioners: Jacobi (from the Ifpack2 package), polynomial (from the Belos package), and algebraic multigrid (from the MueLu package). <br  />
</p>
<h1><a class="anchor" id="sphynx_build"></a>
Building with Sphynx</h1>
<p>Sphynx is an optional subpackage of <a class="el" href="namespaceZoltan2.html" title="Created by mbenlioglu on Aug 31, 2020.">Zoltan2</a>, so enabling <a class="el" href="namespaceZoltan2.html" title="Created by mbenlioglu on Aug 31, 2020.">Zoltan2</a> in Trilinos (by Trilinos_ENABLE_Zoltan2=ON) does not automatically enable it. Sphynx can be enabled by adding </p><pre class="fragment">Trilinos_ENABLE_Zoltan2Sphynx=ON.
</pre><p> Enabling MueLu is not a must for building and using Sphynx, so if you want to use MueLu as preconditioner (which we recommend for regular graphs), you should add Trilinos_ENABLE_MueLu=ON and Trilinos_ENABLE_Amesos2=ON.</p>
<p>We provide a sample script for a CUDA-enabled Trilinos build on Summit in zoltan2/sampleScripts/configure_sphynx_summit. You can try Sphynx by using the test driver in $BUILD_DIR/packages/zoltan2/test/sphynx/Zoltan2_Sphynx.exe if you enable <a class="el" href="namespaceZoltan2.html" title="Created by mbenlioglu on Aug 31, 2020.">Zoltan2</a> tests (by Zoltan2_ENABLE_TESTS=ON).</p>
<p>The last group of CMake flags in the sample script is strongly recommended as we observed that Sphynx is faster with those options.</p>
<h1><a class="anchor" id="sphynx_input"></a>
Input</h1>
<p>As input, Sphynx expects a Zoltan2::XpetraCrsGraphAdapter&lt;GraphType&gt; object, where GraphType=Tpetra::CrsGraph&lt;&gt;. One can create the graph adapter pointer using a Tpetra::CrsMatrix pointer called 'matrix' as follows: </p><pre class="fragment">using GraphAdapter = Zoltan2::XpetraCrsGraphAdapter&lt;typename GraphType&gt;;
Teuchos::RCP&lt;GraphAdapter&gt; adapter(new GraphAdapter(matrix-&gt;getCrsGraph(), nVwgts));
</pre><p> Sphynx supports multiple weights for vertices. In the line above, nVwgts denotes the number of weights each vertex is assigned (i.e., the number of constraints in the graph partitioning problem). For each constraint c, where 0 &lt;= c &lt; nVwgts, the user can provide the weights array or just set the adapter-&gt;setVertexWeightIsDegree(c) to use the vertex degrees as weights. Unlike vertex weights, Sphynx does not support edge weights, which means each edge is assigned a unit cost.</p>
<p>The Tpetra::CrsMatrix object (or equivalently the Tpetra::CrsGraph object) can be obtained by using Tpetra's matrix market reader s follows: </p><pre class="fragment">using Reader = Tpetra::MatrixMarket::Reader&lt;typename CrsMatrixType&gt;;
Reader reader;
Teuchos::RCP&lt;CrsMatrixType&gt; matrix = reader.readSparseFile(mtxFile, comm); 
</pre><p> Warnings:</p><ul>
<li>Sphynx currently requires the graph of the input matrix to be connected. If you have a disconnected graph, you might want to consider using Sphynx on the largest connected component.</li>
<li>Sphynx requires the input matrix/graph to be structurally symmetric. The numerical values don't have to be symmetric as long as it is structurally symmetric.</li>
<li>Sphynx requires the input matrix (graph) to include all the diagonal entries (self loops in the graph). <br  />
</li>
<li>The user has to set params-&gt;set("sphynx_skip_preprocessing", true) to denote that the input graph satisfies these requirements.</li>
</ul>
<h1><a class="anchor" id="sphynx_parameters"></a>
Parameters</h1>
<p>Sphynx enables the user to set various options which are passed by a Teuchos::ParameterList.</p><ul>
<li>To set the number of requested parts, nParts, use params-&gt;set("num_global_parts", nParts).</li>
<li>To set the preconditioner type, use params-&gt;set("sphynx_preconditioner_type", precType) where the valid values for precType are "jacobi", "polynomial", and "muelu".</li>
<li>To set the eigenvalue problem, use params-&gt;set("sphynx_problem_type", problemType), where the valid values for problemType are "combinatorial", "generalized", and "normalized".</li>
<li>To set the convergence tolerance in LOBPCG, use params-&gt;set("sphynx_tolerance", tolerance).</li>
<li>To set whether the initial guess in LOBPCG is random or not, use params-&gt;set("sphynx_initial_guess", initialGuess), where the valid values are "random" and "constants".</li>
</ul>
<h1><a class="anchor" id="sphynx_solution"></a>
Solution</h1>
<p>To obtain the partitioning solution, you need to create a SphynxProblem first and then call its solve function as follows: </p><pre class="fragment">Zoltan2::SphynxProblem&lt;SparseGraphAdapter&gt; problem(adapter, params);
problem.solve();
</pre><p> Then the entries of the resulting solution that are local to the current MPI rank can be accessed through the following parts array: </p><pre class="fragment">auto parts = problem.getSolution().getPartListView(); 
</pre> <h1><a class="anchor" id="sphynx_quality"></a>
Quality Measures</h1>
<p>Sphynx tries to minimize the cutsize in the resulting partition. Since it does not support edge weights, minimizing the cutsize corresponds to minimizing the number of cut edges, i.e., the edges whose end vertices belong to different parts. While doing so, Sphynx also balances the part weights in the resulting partition. Recall that Sphynx supports multiple vertex weights. <br  />
</p>
<h1><a class="anchor" id="sphynx_examples"></a>
Paper(s)</h1>
<p>Refer to the paper for the details Sphynx:</p>
<p>S. Acer, E. G. Boman and S. Rajamanickam, "SPHYNX: Spectral Partitioning for HYbrid aNd aXelerator-enabled systems," 2020 IEEE International Parallel and Distributed Processing Symposium Workshops (IPDPSW), New Orleans, LA, USA, 2020, pp. 440-449, doi: 10.1109/IPDPSW50202.2020.00082.</p>
<h1><a class="anchor" id="sphynx_source"></a>
Source</h1>
<p>Source code of Sphynx is located in <a class="el" href="Zoltan2__Sphynx_8hpp.html">zoltan2/sphynx/src/Zoltan2_Sphynx.hpp</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
