<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Isorropia: Partitioning, Load Balancing and more: geometric/example_rcb.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Isorropia: Partitioning, Load Balancing and more
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">geometric/example_rcb.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>This example shows how to use geometric partitioning methods with multivectors.</p>
<p>This example shows how to use geometric partitioning methods with multivectors.</p>
<div class="fragment"><div class="line"><span class="comment">//@HEADER</span></div>
<div class="line"><span class="comment">//************************************************************************</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//              Isorropia: Partitioning and Load Balancing Package</span></div>
<div class="line"><span class="comment">//                Copyright (2006) Sandia Corporation</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//Under terms of Contract DE-AC04-94AL85000, there is a non-exclusive</span></div>
<div class="line"><span class="comment">//license for use of this work by or on behalf of the U.S. Government.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">// modification, are permitted provided that the following conditions are</span></div>
<div class="line"><span class="comment">// met:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 1. Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment">// notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 2. Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment">// notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment">// documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 3. Neither the name of the Corporation nor the names of the</span></div>
<div class="line"><span class="comment">// contributors may be used to endorse or promote products derived from</span></div>
<div class="line"><span class="comment">// this software without specific prior written permission.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// THIS SOFTWARE IS PROVIDED BY SANDIA CORPORATION &quot;AS IS&quot; AND ANY</span></div>
<div class="line"><span class="comment">// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div>
<div class="line"><span class="comment">// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span></div>
<div class="line"><span class="comment">// PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL SANDIA CORPORATION OR THE</span></div>
<div class="line"><span class="comment">// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span></div>
<div class="line"><span class="comment">// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span></div>
<div class="line"><span class="comment">// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></div>
<div class="line"><span class="comment">// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span></div>
<div class="line"><span class="comment">// LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></div>
<div class="line"><span class="comment">// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></div>
<div class="line"><span class="comment">// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//************************************************************************</span></div>
<div class="line"><span class="comment">//@HEADER</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Read in the file &quot;simple.coords&quot; and perform geometric partitioning</span></div>
<div class="line"><span class="comment">// with Zoltan&#39;s RCB method.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// --f={filename} will read a different coordinate file</span></div>
<div class="line"><span class="comment">// --v will print out the partitioning (small coordinate files only)</span></div>
<div class="line"><span class="comment">// --rib will use Recursive Inertial Bisection instead of RCB</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The input file should be a</span></div>
<div class="line"><span class="comment">// text file containing 1, 2 or 3-dimensional coordinates, one per line,</span></div>
<div class="line"><span class="comment">// with white space separating coordinate values.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// There are a few other coordinate files in the test/geometric directory.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__ConfigDefs_8hpp.html">Isorropia_ConfigDefs.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__Epetra_8hpp.html">Isorropia_Epetra.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__EpetraPartitioner_8hpp.html">Isorropia_EpetraPartitioner.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__EpetraRedistributor_8hpp.html">Isorropia_EpetraRedistributor.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__CostDescriber_8hpp.html">Isorropia_CostDescriber.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define PRINTLIMIT 5000</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef HAVE_EPETRA</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_Import.h&gt;</span></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_MpiComm.h&gt;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_SerialComm.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_MultiVector.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;Teuchos_CommandLineProcessor.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Teuchos_RCP.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ispatest__lbeval__utils_8hpp.html">ispatest_lbeval_utils.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ispatest__epetra__utils_8hpp.html">ispatest_epetra_utils.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><span class="preprocessor">#include &quot;winprocess.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> fail = 0, dim=0;  </div>
<div class="line">  <span class="keywordtype">int</span> localProc = 0;</div>
<div class="line">  <span class="keywordtype">int</span> numProcs = 1;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line">  MPI_Init(&amp;argc, &amp;argv);</div>
<div class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;localProc);</div>
<div class="line">  MPI_Comm_size(MPI_COMM_WORLD, &amp;numProcs);</div>
<div class="line">  <span class="keyword">const</span> Epetra_MpiComm Comm(MPI_COMM_WORLD);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  <span class="keyword">const</span> Epetra_SerialComm Comm;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (getenv(<span class="stringliteral">&quot;DEBUGME&quot;</span>)){</div>
<div class="line">    std::cerr &lt;&lt; localProc &lt;&lt; <span class="stringliteral">&quot; gdb test_rcb.exe &quot;</span> &lt;&lt; getpid() &lt;&lt; std::endl;</div>
<div class="line">    sleep(15);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line">  <span class="comment">// get command line options</span></div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::CommandLineProcessor clp(<span class="keyword">false</span>,<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">  std::string *inputFile = <span class="keyword">new</span> std::string(<span class="stringliteral">&quot;simple.coords&quot;</span>);</div>
<div class="line">  <span class="keywordtype">bool</span> verbose = <span class="keyword">false</span>;</div>
<div class="line">  <span class="keywordtype">bool</span> rib = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">  clp.setOption( <span class="stringliteral">&quot;f&quot;</span>, inputFile, <span class="stringliteral">&quot;Name of coordinate input file&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  clp.setOption( <span class="stringliteral">&quot;v&quot;</span>, <span class="stringliteral">&quot;q&quot;</span>, &amp;verbose,</div>
<div class="line">                <span class="stringliteral">&quot;Display coordinates and weights before and after partitioning.&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  clp.setOption( <span class="stringliteral">&quot;rib&quot;</span>, <span class="stringliteral">&quot;rcb&quot;</span>, &amp;rib, <span class="stringliteral">&quot;Run RIB instead of RCB&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  Teuchos::CommandLineProcessor::EParseCommandLineReturn parse_return =</div>
<div class="line">    clp.parse(argc,argv);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>( parse_return == Teuchos::CommandLineProcessor::PARSE_HELP_PRINTED){</div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line">    MPI_Finalize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>( parse_return != Teuchos::CommandLineProcessor::PARSE_SUCCESSFUL ) {</div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line">    MPI_Finalize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line">  <span class="comment">// Open file of coordinates and distribute them across processes</span></div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line">  </div>
<div class="line">  Epetra_MultiVector *mv = <a id="a0" name="a0"></a><a class="code hl_function" href="namespaceispatest.html#a16a98b82240ef253e1156a4fe6012d6b">ispatest::file2multivector</a>(Comm, *inputFile);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!mv || ((dim = mv-&gt;NumVectors()) &lt; 1)){</div>
<div class="line">    <span class="keywordflow">if</span> (localProc == 0)</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Invalid input file &quot;</span> &lt;&lt; *inputFile &lt;&lt; std::endl;</div>
<div class="line">    exit(1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> vsize = mv-&gt;GlobalLength();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (verbose){</div>
<div class="line">    <span class="keywordflow">if</span> (vsize &lt; PRINTLIMIT){</div>
<div class="line">      <a id="a1" name="a1"></a><a class="code hl_function" href="namespaceispatest.html#a38d03c56ec987c92034cc3a54fa76f9c">ispatest::printMultiVector</a>(*mv, std::cout, <span class="stringliteral">&quot;Coordinates&quot;</span>,PRINTLIMIT);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span>{</div>
<div class="line">      <span class="keywordflow">if</span> (localProc == 0){</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;--v requested, but input file is larger than &quot;</span> &lt;&lt; PRINTLIMIT &lt;&lt; <span class="stringliteral">&quot; coordinates.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Partitioning will be performed but will not be displayed.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        verbose = <span class="keyword">false</span>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line">  <span class="comment">// Create weights for coordinates - there are three different</span></div>
<div class="line">  <span class="comment">// functions in src/utils/ispatest_epetra_utils.cpp that can</span></div>
<div class="line">  <span class="comment">// create weights for the coordinates.</span></div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Epetra_MultiVector *wgts = ispatest::makeWeights(mv-&gt;Map(), &amp;ispatest::unitWeights);</span></div>
<div class="line">  Epetra_MultiVector *wgts = <a id="a2" name="a2"></a><a class="code hl_function" href="namespaceispatest.html#ae6de8cc3ba9e8b5a2f80952021d71e2c">ispatest::makeWeights</a>(mv-&gt;Map(), &amp;<a id="a3" name="a3"></a><a class="code hl_function" href="namespaceispatest.html#a8b1b2ecbb8b76c493b77822b661d0b58">ispatest::alternateWeights</a>);</div>
<div class="line">  <span class="comment">//Epetra_MultiVector *wgts = ispatest::makeWeights(mv-&gt;Map(), &amp;ispatest::veeWeights);</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!wgts || ((dim = wgts-&gt;NumVectors()) != 1)){</div>
<div class="line">    <span class="keywordflow">if</span> (localProc == 0)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t create weights&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    exit(1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (verbose){ </div>
<div class="line">    <a class="code hl_function" href="namespaceispatest.html#a38d03c56ec987c92034cc3a54fa76f9c">ispatest::printMultiVector</a>(*wgts, std::cout, <span class="stringliteral">&quot;Weights&quot;</span>,PRINTLIMIT);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line">  <span class="comment">//  Create a parameter list for Zoltan</span></div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::ParameterList params;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (rib){</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// This parameter specifies that partitioning should be performed</span></div>
<div class="line">   <span class="comment">// by a simple linear partitioner in Isorropia, rather than calling</span></div>
<div class="line">   <span class="comment">// upon Zoltan.</span></div>
<div class="line"> </div>
<div class="line">   params.set(<span class="stringliteral">&quot;Partitioning Method&quot;</span>, <span class="stringliteral">&quot;RIB&quot;</span>);</div>
<div class="line">   <span class="comment">// params.set(&quot;PARTITIONING_METHOD&quot;, &quot;RIB&quot;); // same as above</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span>{</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// params.set(&quot;Partitioning Method&quot;, &quot;RCB&quot;); // default </span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// To set low-level Zoltan parameters, create a sublist titled &quot;ZOLTAN&quot;</span></div>
<div class="line">    <span class="comment">// with Zoltan parameters in it.  See the Zoltan Users&#39; Guide for</span></div>
<div class="line">    <span class="comment">// Zoltan parameters.  http://www.cs.sandia.gov/Zoltan</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Teuchos::ParameterList &amp;sublist = params.sublist(&quot;ZOLTAN&quot;);</span></div>
<div class="line">    <span class="comment">//sublist.set(&quot;DEBUG_LEVEL&quot;, &quot;1&quot;); // Zoltan will print out parameters</span></div>
<div class="line">    <span class="comment">//sublist.set(&quot;DEBUG_LEVEL&quot;, &quot;5&quot;);   // proc 0 will trace Zoltan calls</span></div>
<div class="line">    <span class="comment">//sublist.set(&quot;DEBUG_MEMORY&quot;, &quot;2&quot;);  // Zoltan will trace alloc &amp; free</span></div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line">  <span class="comment">// Create a partitioner, by default this will perform the partitioning as well</span></div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;const Epetra_MultiVector&gt; mv_rcp = Teuchos::rcp(mv);</div>
<div class="line">  Teuchos::RCP&lt;const Epetra_MultiVector&gt; wgts_rcp = Teuchos::rcp(wgts);</div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Isorropia::Epetra::Partitioner&gt; part =</div>
<div class="line">    Teuchos::rcp(<span class="keyword">new</span> <a id="_a4" name="_a4"></a><a class="code hl_class" href="classIsorropia_1_1Epetra_1_1Partitioner.html">Isorropia::Epetra::Partitioner</a>(mv_rcp, wgts_rcp, params));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a Redistributor based on the partitioning</span></div>
<div class="line"> </div>
<div class="line">  <a id="_a5" name="_a5"></a><a class="code hl_class" href="classIsorropia_1_1Epetra_1_1Redistributor.html">Isorropia::Epetra::Redistributor</a> rd(part);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Redistribute the coordinates</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Epetra_MultiVector&gt; new_mv = rd.<a id="a6" name="a6"></a><a class="code hl_function" href="group__partitioning__grp.html#ga16f92f72eeee1f9c72df706865111503">redistribute</a>(*mv);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (verbose){</div>
<div class="line">    <a class="code hl_function" href="namespaceispatest.html#a38d03c56ec987c92034cc3a54fa76f9c">ispatest::printMultiVector</a>(*new_mv, std::cout, <span class="stringliteral">&quot;New Coordinates&quot;</span>, PRINTLIMIT);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Redistribute the weights</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Epetra_MultiVector&gt; new_wgts = rd.<a class="code hl_function" href="group__partitioning__grp.html#ga16f92f72eeee1f9c72df706865111503">redistribute</a>(*wgts);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (verbose){</div>
<div class="line">    <a class="code hl_function" href="namespaceispatest.html#a38d03c56ec987c92034cc3a54fa76f9c">ispatest::printMultiVector</a>(*new_wgts, std::cout, <span class="stringliteral">&quot;New Weights&quot;</span>, PRINTLIMIT);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line">  <span class="comment">// Compute balance both before and after partitioning</span></div>
<div class="line">  <span class="comment">// =============================================================</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> min1, min2, max1, max2, avg1, avg2;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if 1</span></div>
<div class="line">  <span class="keywordtype">double</span> goal = 1.0 / (double)numProcs;</div>
<div class="line"> </div>
<div class="line">  Epetra_Vector * &amp;w1 = (*wgts)(0);</div>
<div class="line">  <a id="a7" name="a7"></a><a class="code hl_function" href="namespaceispatest.html#adbf4ea860675d758cf2f122abb9562bd">ispatest::compute_balance</a>(*w1, goal, min1, max1, avg1);</div>
<div class="line"> </div>
<div class="line">  Epetra_Vector * &amp;new_w1 = (*new_wgts)(0);</div>
<div class="line">  <a class="code hl_function" href="namespaceispatest.html#adbf4ea860675d758cf2f122abb9562bd">ispatest::compute_balance</a>(*new_w1, goal, min2, max2, avg2);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  std::vector&lt;double&gt; min(2), max(2), avg(2);</div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Epetra_Vector&gt; wgts_copy = </div>
<div class="line">    Teuchos::rcp(<span class="keyword">new</span> Epetra_Vector(Copy, wgts-&gt;Map(), (*wgts)[0]));</div>
<div class="line"> </div>
<div class="line">  <a id="_a8" name="_a8"></a><a class="code hl_class" href="classIsorropia_1_1Epetra_1_1CostDescriber.html">Isorropia::Epetra::CostDescriber</a> costs;</div>
<div class="line"> </div>
<div class="line">  costs.<a id="a9" name="a9"></a><a class="code hl_function" href="classIsorropia_1_1Epetra_1_1CostDescriber.html#a1a132ca196cca2545860c8fe1b8357ee">setVertexWeights</a>(wgts_copy);</div>
<div class="line"> </div>
<div class="line">  Epetra_Import &amp;importer = rd.<a id="a10" name="a10"></a><a class="code hl_function" href="classIsorropia_1_1Epetra_1_1Redistributor.html#a3350bfd8b5ba97148183b5fe06d485ea">get_importer</a>();</div>
<div class="line"> </div>
<div class="line">  costs.compareBeforeAndAfterImbalance(*mv, importer, min, max, avg);</div>
<div class="line"> </div>
<div class="line">  min1 = min[0]; max1 = max[0]; avg1 = avg[0];</div>
<div class="line">  min2 = min[1]; max2 = max[1]; avg2 = avg[1];</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 0){</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Balance before partitioning: min &quot;</span> ;</div>
<div class="line">    std::cout &lt;&lt; min1 &lt;&lt; <span class="stringliteral">&quot; max &quot;</span> &lt;&lt; max1 &lt;&lt; <span class="stringliteral">&quot; average &quot;</span> &lt;&lt; avg1 &lt;&lt; std::endl;</div>
<div class="line">  </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Balance after partitioning:  min &quot;</span>;</div>
<div class="line">    std::cout &lt;&lt; min2 &lt;&lt; <span class="stringliteral">&quot; max &quot;</span> &lt;&lt; max2 &lt;&lt; <span class="stringliteral">&quot; average &quot;</span> &lt;&lt; avg2 &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line">  MPI_Finalize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> fail;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif   </span><span class="comment">// HAVE_EPETRA</span></div>
<div class="ttc" id="aIsorropia__ConfigDefs_8hpp_html"><div class="ttname"><a href="Isorropia__ConfigDefs_8hpp.html">Isorropia_ConfigDefs.hpp</a></div></div>
<div class="ttc" id="aIsorropia__CostDescriber_8hpp_html"><div class="ttname"><a href="Isorropia__CostDescriber_8hpp.html">Isorropia_CostDescriber.hpp</a></div></div>
<div class="ttc" id="aIsorropia__EpetraPartitioner_8hpp_html"><div class="ttname"><a href="Isorropia__EpetraPartitioner_8hpp.html">Isorropia_EpetraPartitioner.hpp</a></div><div class="ttdoc">Contains functionality used for partitioning Epetra matrices, maps, multivectors, etc.</div></div>
<div class="ttc" id="aIsorropia__EpetraRedistributor_8hpp_html"><div class="ttname"><a href="Isorropia__EpetraRedistributor_8hpp.html">Isorropia_EpetraRedistributor.hpp</a></div></div>
<div class="ttc" id="aIsorropia__Epetra_8hpp_html"><div class="ttname"><a href="Isorropia__Epetra_8hpp.html">Isorropia_Epetra.hpp</a></div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1CostDescriber_html"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1CostDescriber.html">Isorropia::Epetra::CostDescriber</a></div><div class="ttdef"><b>Definition</b> Isorropia_EpetraCostDescriber.hpp:128</div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1CostDescriber_html_a1a132ca196cca2545860c8fe1b8357ee"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1CostDescriber.html#a1a132ca196cca2545860c8fe1b8357ee">Isorropia::Epetra::CostDescriber::setVertexWeights</a></div><div class="ttdeci">void setVertexWeights(Teuchos::RCP&lt; const Epetra_Vector &gt; vwgts)</div><div class="ttdoc">setVertexWeights is called by a process to supply the weight of each vertex (row) in the graph or hyp...</div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1Partitioner_html"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1Partitioner.html">Isorropia::Epetra::Partitioner</a></div><div class="ttdoc">An implementation of the Partitioner interface that operates on Epetra matrices and linear systems.</div><div class="ttdef"><b>Definition</b> Isorropia_EpetraPartitioner.hpp:122</div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1Redistributor_html"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1Redistributor.html">Isorropia::Epetra::Redistributor</a></div><div class="ttdoc">Class which is constructed with a Partitioner instance, and provides several methods for redistributi...</div><div class="ttdef"><b>Definition</b> Isorropia_EpetraRedistributor.hpp:72</div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1Redistributor_html_a3350bfd8b5ba97148183b5fe06d485ea"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1Redistributor.html#a3350bfd8b5ba97148183b5fe06d485ea">Isorropia::Epetra::Redistributor::get_importer</a></div><div class="ttdeci">Epetra_Import &amp; get_importer()</div><div class="ttdef"><b>Definition</b> Isorropia_EpetraRedistributor.hpp:317</div></div>
<div class="ttc" id="agroup__partitioning__grp_html_ga16f92f72eeee1f9c72df706865111503"><div class="ttname"><a href="group__partitioning__grp.html#ga16f92f72eeee1f9c72df706865111503">Isorropia::Epetra::Redistributor::redistribute</a></div><div class="ttdeci">void redistribute(const Epetra_SrcDistObject &amp;src, Epetra_DistObject &amp;target)</div><div class="ttdoc">Method to redistribute a Epetra_SrcDistObject into a Epetra_DistObject.</div></div>
<div class="ttc" id="aispatest__epetra__utils_8hpp_html"><div class="ttname"><a href="ispatest__epetra__utils_8hpp.html">ispatest_epetra_utils.hpp</a></div></div>
<div class="ttc" id="aispatest__lbeval__utils_8hpp_html"><div class="ttname"><a href="ispatest__lbeval__utils_8hpp.html">ispatest_lbeval_utils.hpp</a></div></div>
<div class="ttc" id="anamespaceispatest_html_a16a98b82240ef253e1156a4fe6012d6b"><div class="ttname"><a href="namespaceispatest.html#a16a98b82240ef253e1156a4fe6012d6b">ispatest::file2multivector</a></div><div class="ttdeci">Epetra_MultiVector * file2multivector(const Epetra_Comm &amp;comm, const std::string &amp;fname)</div><div class="ttdoc">Read in a file of 1, 2 or 3 dimensional coordinates and create a multivector with a standard linear d...</div></div>
<div class="ttc" id="anamespaceispatest_html_a38d03c56ec987c92034cc3a54fa76f9c"><div class="ttname"><a href="namespaceispatest.html#a38d03c56ec987c92034cc3a54fa76f9c">ispatest::printMultiVector</a></div><div class="ttdeci">int printMultiVector(const Epetra_MultiVector &amp;mv, std::ostream &amp;os, const char *s, int max=1000)</div><div class="ttdoc">Print out the contents of the multivector by process, with optional title.</div></div>
<div class="ttc" id="anamespaceispatest_html_a8b1b2ecbb8b76c493b77822b661d0b58"><div class="ttname"><a href="namespaceispatest.html#a8b1b2ecbb8b76c493b77822b661d0b58">ispatest::alternateWeights</a></div><div class="ttdeci">double alternateWeights(const int id, const int me, const int nids, const int nprocs)</div><div class="ttdoc">A function for makeWeights, weights alternate 1.0, 2.0, 1.0, etc.</div></div>
<div class="ttc" id="anamespaceispatest_html_adbf4ea860675d758cf2f122abb9562bd"><div class="ttname"><a href="namespaceispatest.html#adbf4ea860675d758cf2f122abb9562bd">ispatest::compute_balance</a></div><div class="ttdeci">int compute_balance(const Epetra_Vector &amp;wgts, double myGoalWeight, double &amp;min, double &amp;max, double &amp;avg)</div><div class="ttdoc">Given an Epetra_Vector of weights, compute the weight imbalance on each process.</div></div>
<div class="ttc" id="anamespaceispatest_html_ae6de8cc3ba9e8b5a2f80952021d71e2c"><div class="ttname"><a href="namespaceispatest.html#ae6de8cc3ba9e8b5a2f80952021d71e2c">ispatest::makeWeights</a></div><div class="ttdeci">Epetra_MultiVector * makeWeights(const Epetra_BlockMap &amp;map, double(*wFunc)(const int, const int, const int, const int))</div><div class="ttdoc">Create a multivector of 1 dimensional weights with the same distribution as the supplied map.</div></div>
</div><!-- fragment --> </div><!-- contents -->
</BODY>
</HTML>
