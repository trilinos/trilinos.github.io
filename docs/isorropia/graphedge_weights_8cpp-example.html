<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Isorropia: Partitioning, Load Balancing and more: graphedge_weights.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Isorropia: Partitioning, Load Balancing and more
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">graphedge_weights.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>This example shows how to use graph partitioning methods with edge weights.</p>
<p>This example shows how to use graph partitioning methods with edge weights.</p>
<div class="fragment"><div class="line"><span class="comment">//@HEADER</span></div>
<div class="line"><span class="comment">//************************************************************************</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//              Isorropia: Partitioning and Load Balancing Package</span></div>
<div class="line"><span class="comment">//                Copyright (2006) Sandia Corporation</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//Under terms of Contract DE-AC04-94AL85000, there is a non-exclusive</span></div>
<div class="line"><span class="comment">//license for use of this work by or on behalf of the U.S. Government.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">// modification, are permitted provided that the following conditions are</span></div>
<div class="line"><span class="comment">// met:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 1. Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment">// notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 2. Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment">// notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment">// documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 3. Neither the name of the Corporation nor the names of the</span></div>
<div class="line"><span class="comment">// contributors may be used to endorse or promote products derived from</span></div>
<div class="line"><span class="comment">// this software without specific prior written permission.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// THIS SOFTWARE IS PROVIDED BY SANDIA CORPORATION &quot;AS IS&quot; AND ANY</span></div>
<div class="line"><span class="comment">// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div>
<div class="line"><span class="comment">// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span></div>
<div class="line"><span class="comment">// PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL SANDIA CORPORATION OR THE</span></div>
<div class="line"><span class="comment">// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span></div>
<div class="line"><span class="comment">// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span></div>
<div class="line"><span class="comment">// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></div>
<div class="line"><span class="comment">// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span></div>
<div class="line"><span class="comment">// LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></div>
<div class="line"><span class="comment">// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></div>
<div class="line"><span class="comment">// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//************************************************************************</span></div>
<div class="line"><span class="comment">//@HEADER</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//--------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//This file is a self-contained example of creating an Epetra_RowMatrix</span></div>
<div class="line"><span class="comment">//object, and using Isorropia to create a rebalanced copy of it.</span></div>
<div class="line"><span class="comment">//Furthermore graph-edge weights are used to influence the repartitioning.</span></div>
<div class="line"><span class="comment">//--------------------------------------------------------------------</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//Include Isorropia_Exception.hpp only because the helper functions at</span></div>
<div class="line"><span class="comment">//the bottom of this file (which create the epetra objects) can</span></div>
<div class="line"><span class="comment">//potentially throw exceptions.</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__Exception_8hpp.html">Isorropia_Exception.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//The Isorropia symbols being demonstrated are declared</span></div>
<div class="line"><span class="comment">//in these headers:</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__Epetra_8hpp.html">Isorropia_Epetra.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__EpetraCostDescriber_8hpp.html">Isorropia_EpetraCostDescriber.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__EpetraRedistributor_8hpp.html">Isorropia_EpetraRedistributor.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Isorropia__EpetraPartitioner_8hpp.html">Isorropia_EpetraPartitioner.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef HAVE_EPETRA</span></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_MpiComm.h&gt;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_SerialComm.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_Map.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_Vector.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_CrsMatrix.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Epetra_FECrsMatrix.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ispatest__lbeval__utils_8hpp.html">ispatest_lbeval_utils.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div>
<div class="line"><span class="preprocessor">#if defined(HAVE_MPI) &amp;&amp; defined(HAVE_EPETRA)</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> numProcs = 1;</div>
<div class="line">  <span class="keywordtype">int</span> localProc = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//first, set up our MPI environment...</span></div>
<div class="line">  MPI_Init(&amp;argc, &amp;argv);</div>
<div class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;localProc);</div>
<div class="line">  MPI_Comm_size(MPI_COMM_WORLD, &amp;numProcs);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This program can only run on 3 processors, to make things</span></div>
<div class="line"><span class="comment">// work out easy.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span> (numProcs != 3) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;num-procs=&quot;</span>&lt;&lt;numProcs&lt;&lt;<span class="stringliteral">&quot;. This program can only &quot;</span></div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot;run on 3 procs. Exiting.&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">    MPI_Finalize();</div>
<div class="line">    <span class="keywordflow">return</span>(0);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Consider the following mesh of 4 2-D quad elements:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  *-------*-------*</span></div>
<div class="line"><span class="comment">// 8|      7|      6|</span></div>
<div class="line"><span class="comment">//  |  E2   |  E3   |</span></div>
<div class="line"><span class="comment">//  *-------*-------*</span></div>
<div class="line"><span class="comment">// 3|      2|      5|</span></div>
<div class="line"><span class="comment">//  |  E0   |  E1   |</span></div>
<div class="line"><span class="comment">//  *-------*-------*</span></div>
<div class="line"><span class="comment">// 0       1       4</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Node-ids are to the lower-left of each node (*).</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Mimicing a finite-element application, we will say that</span></div>
<div class="line"><span class="comment">// each node has 1 scalar degree-of-freedom, and assemble</span></div>
<div class="line"><span class="comment">// a matrix which would have 9 global rows and columns.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Each processor will have 3 rows. We&#39;ll set up a strange</span></div>
<div class="line"><span class="comment">// initial map, where nodes are distributed as follows:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// proc 0: nodes 0,3,8,</span></div>
<div class="line"><span class="comment">// proc 1: nodes 1,2,7</span></div>
<div class="line"><span class="comment">// proc 2: nodes 4,5,6.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// After we assemble our matrix, we&#39;ll create another matrix</span></div>
<div class="line"><span class="comment">// and populate it with graph edge weights such that the</span></div>
<div class="line"><span class="comment">// partitioner repartitions the problem so that nodes are</span></div>
<div class="line"><span class="comment">// laid out as follows:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// proc 0: nodes 0, 1, 4</span></div>
<div class="line"><span class="comment">// proc 1: nodes 3, 2, 5</span></div>
<div class="line"><span class="comment">// proc 2: nodes 8, 7, 6</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> nodesPerElem = 4;</div>
<div class="line">  <span class="keywordtype">int</span> global_n = 9;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//First, set up the initial map:</span></div>
<div class="line"> </div>
<div class="line">  std::vector&lt;int&gt; mynodes(3);</div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 0) {</div>
<div class="line">    mynodes[0] = 0; mynodes[1] = 3; mynodes[2] = 8;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 1) {</div>
<div class="line">    mynodes[0] = 1; mynodes[1] = 2; mynodes[2] = 7;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 2) {</div>
<div class="line">    mynodes[0] = 4; mynodes[1] = 5; mynodes[2] = 6;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  Epetra_MpiComm comm(MPI_COMM_WORLD);</div>
<div class="line">  Epetra_Map origmap(global_n, 3, &amp;mynodes[0], 0, comm);</div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Epetra_FECrsMatrix&gt; matrix =</div>
<div class="line">    Teuchos::rcp(<span class="keyword">new</span> Epetra_FECrsMatrix(Copy, origmap, 0));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//We&#39;ll assemble elements E0 and E1 on proc 0,</span></div>
<div class="line">  <span class="comment">//               element E2 or proc 1,</span></div>
<div class="line">  <span class="comment">//               element E3 on proc 2.</span></div>
<div class="line"> </div>
<div class="line">  std::vector&lt;int&gt; indices(nodesPerElem);</div>
<div class="line">  std::vector&lt;double&gt; coefs(nodesPerElem*nodesPerElem,2.0);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 0) {</div>
<div class="line">    <span class="comment">//element E0:</span></div>
<div class="line">    indices[0] = 0; indices[1] = 1; indices[2] = 2; indices[3] = 3;</div>
<div class="line">    matrix-&gt;InsertGlobalValues(nodesPerElem, &amp;indices[0], &amp;coefs[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//element E1:</span></div>
<div class="line">    indices[0] = 1; indices[1] = 4; indices[2] = 5; indices[3] = 2;</div>
<div class="line">    matrix-&gt;InsertGlobalValues(nodesPerElem, &amp;indices[0], &amp;coefs[0]);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (localProc == 1) {</div>
<div class="line">    <span class="comment">//element E2:</span></div>
<div class="line">    indices[0] = 3; indices[1] = 2; indices[2] = 7; indices[3] = 8;</div>
<div class="line">    matrix-&gt;InsertGlobalValues(nodesPerElem, &amp;indices[0], &amp;coefs[0]);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> { <span class="comment">//localProc==2</span></div>
<div class="line">    <span class="comment">//element E3:</span></div>
<div class="line">    indices[0] = 2; indices[1] = 5; indices[2] = 6; indices[3] = 7;</div>
<div class="line">    matrix-&gt;InsertGlobalValues(nodesPerElem, &amp;indices[0], &amp;coefs[0]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> err = matrix-&gt;GlobalAssemble();</div>
<div class="line">  <span class="keywordflow">if</span> (err != 0) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;err=&quot;</span>&lt;&lt;err&lt;&lt;<span class="stringliteral">&quot; returned from matrix-&gt;GlobalAssemble()&quot;</span></div>
<div class="line">      &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  std::cout &lt;&lt; &quot;matrix: &quot; &lt;&lt; std::endl;</span></div>
<div class="line"><span class="comment">//  std::cout &lt;&lt; *matrix &lt;&lt; std::endl;</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//We&#39;ll need a Teuchos::ParameterList object to pass to the</span></div>
<div class="line">  <span class="comment">//Isorropia::Epetra::Partitioner class.</span></div>
<div class="line">  Teuchos::ParameterList paramlist;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef HAVE_ISORROPIA_ZOLTAN</span></div>
<div class="line">  <span class="comment">// If Zoltan is available, we&#39;ll specify that the Zoltan package be</span></div>
<div class="line">  <span class="comment">// used for the partitioning operation, by creating a parameter</span></div>
<div class="line">  <span class="comment">// sublist named &quot;Zoltan&quot;.</span></div>
<div class="line">  <span class="comment">// In the sublist, we&#39;ll set parameters that we want sent to Zoltan.</span></div>
<div class="line"> </div>
<div class="line">  paramlist.set(<span class="stringliteral">&quot;PARTITIONING METHOD&quot;</span>, <span class="stringliteral">&quot;GRAPH&quot;</span>);</div>
<div class="line">  paramlist.set(<span class="stringliteral">&quot;PRINT ZOLTAN METRICS&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>);</div>
<div class="line">  Teuchos::ParameterList&amp; sublist = paramlist.sublist(<span class="stringliteral">&quot;Zoltan&quot;</span>);</div>
<div class="line">  sublist.set(<span class="stringliteral">&quot;GRAPH_PACKAGE&quot;</span>, <span class="stringliteral">&quot;PHG&quot;</span>); <span class="comment">// Use ParMetis or Scotch if you have it</span></div>
<div class="line">  sublist.set(<span class="stringliteral">&quot;EDGE_WEIGHT_DIM&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>); <span class="comment">// One weight per edge</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//sublist.set(&quot;DEBUG_LEVEL&quot;, &quot;1&quot;); // Zoltan will print out parameters</span></div>
<div class="line">  <span class="comment">//sublist.set(&quot;DEBUG_LEVEL&quot;, &quot;5&quot;);   // proc 0 will trace Zoltan calls</span></div>
<div class="line">  <span class="comment">//sublist.set(&quot;DEBUG_MEMORY&quot;, &quot;2&quot;);  // Zoltan will trace alloc &amp; free</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  <span class="comment">// If Zoltan is not available, a simple linear partitioner will be</span></div>
<div class="line">  <span class="comment">// used to partition such that the number of nonzeros is equal (or</span></div>
<div class="line">  <span class="comment">// close to equal) on each processor. No parameter is necessary to</span></div>
<div class="line">  <span class="comment">// specify this.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Isorropia::Epetra::CostDescriber&gt; costs =</div>
<div class="line">    Teuchos::rcp(<span class="keyword">new</span> <a id="_a0" name="_a0"></a><a class="code hl_class" href="classIsorropia_1_1Epetra_1_1CostDescriber.html">Isorropia::Epetra::CostDescriber</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Next create a matrix which is a copy of the matrix we just</span></div>
<div class="line">  <span class="comment">//assembled, but we&#39;ll replace the values with graph edge weights.</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Epetra_FECrsMatrix&gt; ge_weights =</div>
<div class="line">    Teuchos::rcp(<span class="keyword">new</span> Epetra_FECrsMatrix(*matrix));</div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Epetra_CrsMatrix&gt; crs_ge_weights;</div>
<div class="line">  crs_ge_weights = ge_weights;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Fill the matrix with a &quot;default&quot; weight of 1.0.</span></div>
<div class="line">  crs_ge_weights-&gt;PutScalar(1.0);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Now we&#39;ll put a &quot;large&quot; weight on edges that connect nodes</span></div>
<div class="line">  <span class="comment">//0 and 1, 1 and 4,</span></div>
<div class="line">  <span class="comment">//3 and 2, 2 and 5,</span></div>
<div class="line">  <span class="comment">//8 and 7, 7 and 6.</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> weight = 500.0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 0) {</div>
<div class="line">    <span class="comment">//row 0, edge 1</span></div>
<div class="line">    indices[0] = 1;</div>
<div class="line">    coefs[0] = weight;</div>
<div class="line">    crs_ge_weights-&gt;ReplaceGlobalValues(0, 1, &amp;coefs[0], &amp;indices[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//row 3, edge 2</span></div>
<div class="line">    indices[0] = 2;</div>
<div class="line">    coefs[0] = weight;</div>
<div class="line">    crs_ge_weights-&gt;ReplaceGlobalValues(3, 1, &amp;coefs[0], &amp;indices[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//row 8, edge 7</span></div>
<div class="line">    indices[0] = 7;</div>
<div class="line">    coefs[0] = weight;</div>
<div class="line">    crs_ge_weights-&gt;ReplaceGlobalValues(8, 1, &amp;coefs[0], &amp;indices[0]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 1) {</div>
<div class="line">    <span class="comment">//row 1, edges 0 and 4</span></div>
<div class="line">    indices[0] = 0; indices[1] = 4;</div>
<div class="line">    coefs[0] = weight; coefs[1] = weight;</div>
<div class="line">    crs_ge_weights-&gt;ReplaceGlobalValues(1, 2, &amp;coefs[0], &amp;indices[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//row 2, edges 3 and 5</span></div>
<div class="line">    indices[0] = 3; indices[1] = 5;</div>
<div class="line">    coefs[0] = weight; coefs[1] = weight;</div>
<div class="line">    crs_ge_weights-&gt;ReplaceGlobalValues(2, 2, &amp;coefs[0], &amp;indices[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//row 7, edges 6 and 8</span></div>
<div class="line">    indices[0] = 6; indices[1] = 8;</div>
<div class="line">    coefs[0] = weight;</div>
<div class="line">    crs_ge_weights-&gt;ReplaceGlobalValues(7, 2, &amp;coefs[0], &amp;indices[0]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 2) {</div>
<div class="line">    <span class="comment">//row 4, edge 1</span></div>
<div class="line">    indices[0] = 1;</div>
<div class="line">    coefs[0] = weight;</div>
<div class="line">    crs_ge_weights-&gt;ReplaceGlobalValues(4, 1, &amp;coefs[0], &amp;indices[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//row 5, edge 2</span></div>
<div class="line">    indices[0] = 2;</div>
<div class="line">    coefs[0] = weight;</div>
<div class="line">    crs_ge_weights-&gt;ReplaceGlobalValues(5, 1, &amp;coefs[0], &amp;indices[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//row 6, edge 7</span></div>
<div class="line">    indices[0] = 7;</div>
<div class="line">    coefs[0] = weight;</div>
<div class="line">    crs_ge_weights-&gt;ReplaceGlobalValues(6, 1, &amp;coefs[0], &amp;indices[0]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="comment">// std::cout &lt;&lt; &quot;crs_ge_weights: &quot; &lt;&lt; std::endl</span></div>
<div class="line"><span class="comment">//       &lt;&lt; *crs_ge_weights &lt;&lt; std::endl;</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Now give the graph edge weights to the CostDescriber:</span></div>
<div class="line">  costs-&gt;setGraphEdgeWeights(crs_ge_weights);</div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;const Epetra_RowMatrix&gt; rowmatrix;</div>
<div class="line">  rowmatrix = matrix;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Now create the partitioner object using an Isorropia factory-like</span></div>
<div class="line">  <span class="comment">//function...</span></div>
<div class="line">  Teuchos::RCP&lt;Isorropia::Epetra::Partitioner&gt; partitioner =</div>
<div class="line">    Teuchos::rcp(<span class="keyword">new</span> <a id="_a1" name="_a1"></a><a class="code hl_class" href="classIsorropia_1_1Epetra_1_1Partitioner.html">Isorropia::Epetra::Partitioner</a>(rowmatrix, costs, paramlist));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Next create a Redistributor object and use it to create a</span></div>
<div class="line">  <span class="comment">//repartitioned copy of the matrix</span></div>
<div class="line"> </div>
<div class="line">  <a id="_a2" name="_a2"></a><a class="code hl_class" href="classIsorropia_1_1Epetra_1_1Redistributor.html">Isorropia::Epetra::Redistributor</a> rd(partitioner);</div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Epetra_CrsMatrix&gt; bal_matrix;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Use a try-catch block because Isorropia will throw an exception</span></div>
<div class="line">  <span class="comment">//if it encounters an error.</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 0) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; calling Isorropia::Epetra::Redistributor::redistribute...&quot;</span></div>
<div class="line">        &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    bal_matrix = rd.<a id="a3" name="a3"></a><a class="code hl_function" href="group__partitioning__grp.html#ga16f92f72eeee1f9c72df706865111503">redistribute</a>(*rowmatrix);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span>(std::exception&amp; exc) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;linsys example: Isorropia::Epetra::Redistributor threw &quot;</span></div>
<div class="line">         &lt;&lt; <span class="stringliteral">&quot;exception &#39;&quot;</span> &lt;&lt; exc.what() &lt;&lt; <span class="stringliteral">&quot;&#39; on proc &quot;</span></div>
<div class="line">         &lt;&lt; localProc &lt;&lt; std::endl;</div>
<div class="line">    MPI_Finalize();</div>
<div class="line">    <span class="keywordflow">return</span>(-1);</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// Results</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> bal0, bal1, cutn0, cutn1, cutl0, cutl1, cutWgt0, cutWgt1;</div>
<div class="line">  <span class="keywordtype">int</span> numCuts0, numCuts1;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if 1</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Balance and cut quality before partitioning</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> goalWeight = 1.0 / (double)numProcs;</div>
<div class="line">  <a id="a4" name="a4"></a><a class="code hl_function" href="namespaceispatest.html#a678bc9037c712e4cc7a09c1ca81ea4f3">ispatest::compute_graph_metrics</a>(*rowmatrix, *costs, goalWeight,</div>
<div class="line">                     bal0, numCuts0, cutWgt0, cutn0, cutl0);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Balance and cut quality after partitioning</span></div>
<div class="line"> </div>
<div class="line">  Teuchos::RCP&lt;Epetra_CrsMatrix&gt; new_weights = rd.<a class="code hl_function" href="group__partitioning__grp.html#ga16f92f72eeee1f9c72df706865111503">redistribute</a>(*crs_ge_weights);</div>
<div class="line">  <a class="code hl_class" href="classIsorropia_1_1Epetra_1_1CostDescriber.html">Isorropia::Epetra::CostDescriber</a> new_costs;</div>
<div class="line">  new_costs.<a id="a5" name="a5"></a><a class="code hl_function" href="classIsorropia_1_1Epetra_1_1CostDescriber.html#a852c85e6735155b7d312308684365fa8">setGraphEdgeWeights</a>(new_weights);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="namespaceispatest.html#a678bc9037c712e4cc7a09c1ca81ea4f3">ispatest::compute_graph_metrics</a>(*bal_matrix, new_costs, goalWeight,</div>
<div class="line">                     bal1, numCuts1, cutWgt1, cutn1, cutl1);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  std::vector&lt;double&gt; bal(2), cutwgt(2), cutn(2), cutl(2);</div>
<div class="line">  std::vector&lt;int &gt;ncuts(2);</div>
<div class="line"> </div>
<div class="line">  Epetra_Import &amp;importer = rd.<a id="a6" name="a6"></a><a class="code hl_function" href="classIsorropia_1_1Epetra_1_1Redistributor.html#a3350bfd8b5ba97148183b5fe06d485ea">get_importer</a>();</div>
<div class="line"> </div>
<div class="line">  costs-&gt;compareBeforeAndAfterGraph(*rowmatrix, *bal_matrix, importer,</div>
<div class="line">             bal, ncuts, cutwgt, cutn, cutl);</div>
<div class="line"> </div>
<div class="line">  bal0 = bal[0]; cutn0 = cutn[0]; cutl0 = cutl[0]; cutWgt0 = cutwgt[0]; numCuts0 = ncuts[0];</div>
<div class="line">  bal1 = bal[1]; cutn1 = cutn[1]; cutl1 = cutl[1]; cutWgt1 = cutwgt[1]; numCuts1 = ncuts[1];</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  bal_matrix.release();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (localProc == 0){</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Before partitioning: Number of cuts &quot;</span> &lt;&lt; numCuts0 &lt;&lt; <span class="stringliteral">&quot; Cut weight &quot;</span> &lt;&lt; cutWgt0 &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;                     Balance &quot;</span> &lt;&lt; bal0 &lt;&lt; <span class="stringliteral">&quot; cutN &quot;</span> &lt;&lt; cutn0 &lt;&lt; <span class="stringliteral">&quot; cutL &quot;</span> &lt;&lt; cutl0;</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;After partitioning:  Number of cuts &quot;</span> &lt;&lt; numCuts1 &lt;&lt; <span class="stringliteral">&quot; Cut weight &quot;</span> &lt;&lt; cutWgt1 &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;                     Balance &quot;</span> &lt;&lt; bal1 &lt;&lt; <span class="stringliteral">&quot; cutN &quot;</span> &lt;&lt; cutn1 &lt;&lt; <span class="stringliteral">&quot; cutL &quot;</span> &lt;&lt; cutl1;</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  MPI_Finalize();</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;part_redist: must have both MPI and EPETRA. Make sure Trilinos &quot;</span></div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;is configured with --enable-mpi and --enable-epetra.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span>(0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="aIsorropia__EpetraCostDescriber_8hpp_html"><div class="ttname"><a href="Isorropia__EpetraCostDescriber_8hpp.html">Isorropia_EpetraCostDescriber.hpp</a></div></div>
<div class="ttc" id="aIsorropia__EpetraPartitioner_8hpp_html"><div class="ttname"><a href="Isorropia__EpetraPartitioner_8hpp.html">Isorropia_EpetraPartitioner.hpp</a></div><div class="ttdoc">Contains functionality used for partitioning Epetra matrices, maps, multivectors, etc.</div></div>
<div class="ttc" id="aIsorropia__EpetraRedistributor_8hpp_html"><div class="ttname"><a href="Isorropia__EpetraRedistributor_8hpp.html">Isorropia_EpetraRedistributor.hpp</a></div></div>
<div class="ttc" id="aIsorropia__Epetra_8hpp_html"><div class="ttname"><a href="Isorropia__Epetra_8hpp.html">Isorropia_Epetra.hpp</a></div></div>
<div class="ttc" id="aIsorropia__Exception_8hpp_html"><div class="ttname"><a href="Isorropia__Exception_8hpp.html">Isorropia_Exception.hpp</a></div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1CostDescriber_html"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1CostDescriber.html">Isorropia::Epetra::CostDescriber</a></div><div class="ttdef"><b>Definition</b> Isorropia_EpetraCostDescriber.hpp:128</div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1CostDescriber_html_a852c85e6735155b7d312308684365fa8"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1CostDescriber.html#a852c85e6735155b7d312308684365fa8">Isorropia::Epetra::CostDescriber::setGraphEdgeWeights</a></div><div class="ttdeci">void setGraphEdgeWeights(Teuchos::RCP&lt; const Epetra_CrsMatrix &gt; gewts)</div><div class="ttdoc">setGraphEdgeWeights is called by a process to supply the weights for each of the edges of its vertice...</div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1Partitioner_html"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1Partitioner.html">Isorropia::Epetra::Partitioner</a></div><div class="ttdoc">An implementation of the Partitioner interface that operates on Epetra matrices and linear systems.</div><div class="ttdef"><b>Definition</b> Isorropia_EpetraPartitioner.hpp:122</div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1Redistributor_html"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1Redistributor.html">Isorropia::Epetra::Redistributor</a></div><div class="ttdoc">Class which is constructed with a Partitioner instance, and provides several methods for redistributi...</div><div class="ttdef"><b>Definition</b> Isorropia_EpetraRedistributor.hpp:72</div></div>
<div class="ttc" id="aclassIsorropia_1_1Epetra_1_1Redistributor_html_a3350bfd8b5ba97148183b5fe06d485ea"><div class="ttname"><a href="classIsorropia_1_1Epetra_1_1Redistributor.html#a3350bfd8b5ba97148183b5fe06d485ea">Isorropia::Epetra::Redistributor::get_importer</a></div><div class="ttdeci">Epetra_Import &amp; get_importer()</div><div class="ttdef"><b>Definition</b> Isorropia_EpetraRedistributor.hpp:317</div></div>
<div class="ttc" id="agroup__partitioning__grp_html_ga16f92f72eeee1f9c72df706865111503"><div class="ttname"><a href="group__partitioning__grp.html#ga16f92f72eeee1f9c72df706865111503">Isorropia::Epetra::Redistributor::redistribute</a></div><div class="ttdeci">void redistribute(const Epetra_SrcDistObject &amp;src, Epetra_DistObject &amp;target)</div><div class="ttdoc">Method to redistribute a Epetra_SrcDistObject into a Epetra_DistObject.</div></div>
<div class="ttc" id="aispatest__lbeval__utils_8hpp_html"><div class="ttname"><a href="ispatest__lbeval__utils_8hpp.html">ispatest_lbeval_utils.hpp</a></div></div>
<div class="ttc" id="anamespaceispatest_html_a678bc9037c712e4cc7a09c1ca81ea4f3"><div class="ttname"><a href="namespaceispatest.html#a678bc9037c712e4cc7a09c1ca81ea4f3">ispatest::compute_graph_metrics</a></div><div class="ttdeci">int compute_graph_metrics(const Epetra_RowMatrix &amp;matrix, Isorropia::Epetra::CostDescriber &amp;costs, double &amp;myGoalWeight, double &amp;balance, int &amp;numCuts, double &amp;cutWgt, double &amp;cutn, double &amp;cutl)</div><div class="ttdoc">Compute graph metrics given an Epetra_RowMatrix.</div></div>
</div><!-- fragment --> </div><!-- contents -->
</BODY>
</HTML>
